{"version":3,"file":"compat.js","sources":["src/logger.js","src/object.js","src/population.js","src/stat.js","src/environment.js","src/lru.js","src/flag.js","src/router.js","src/validators/core_validator.js","src/transformers/core_transformer.js","src/core.js","src/index.js","src/compat.js"],"sourcesContent":["export let logger = x => {\n  console.error(x)\n}\n\nexport function setLogger(fn) {\n  logger = fn\n}\n","import Ajv from 'ajv'\nimport ajvErrors from 'ajv-errors'\nimport md5 from 'md5'\nimport {logger} from './logger'\nimport stringify from 'fast-json-stable-stringify'\n\nconst SCHEMA = {\n  type: 'object',\n  properties: {\n    type: {\n      type: 'string',\n      pattern: '^([A-Z][a-zA-Z]*)+$',\n      maxLength: 50,\n      minLength: 1,\n      errorMessage: {\n        type:\n          'Entity type must be a string that starts with a capital letter like [C]ar or [U]ser',\n        maxLength:\n          'Entity type must be a non-empty string of 50 characters or less',\n        minLength:\n          'Entity type must be a non-empty string of 50 characters or less'\n      }\n    },\n    isGroup: {\n      type: 'boolean',\n      errorMessage: {\n        type: '`isGroup` must be a boolean'\n      }\n    },\n    id: {\n      type: ['string', 'integer'],\n      pattern: '^[ -~]+$',\n      maxLength: 250,\n      minLength: 1,\n      errorMessage: {\n        type:\n          \"An entity's `id` must be a string or integer. An integer `id` will be cast into a string.\",\n        maxLength:\n          \"An entity's `id` must be a non-empty string of 250 characters or less.\",\n        minLength:\n          \"An entity's `id` must be a non-empty string of 250 characters or less.\"\n      }\n    },\n    displayName: {\n      type: 'string',\n      maxLength: 250,\n      minLength: 1,\n      errorMessage: {\n        type: \"An entity's `displayName` must be a string\",\n        maxLength:\n          \"An entity's `displayName` must be a non-empty string of 250 characters or less.\",\n        minLength:\n          \"An entity's `displayName` must be a non-empty string of 250 characters or less.\"\n      }\n    },\n    attributes: {\n      type: 'object',\n      patternProperties: {\n        '^[a-zA-Z]$|^[a-zA-Z_]{0,48}[a-zA-Z]$': {\n          oneOf: [\n            {\n              type: 'string',\n              maxLength: 3000,\n              errorMessage: {\n                type:\n                  \"An entity's attribute value must be a string, boolean, or number.\",\n                maxLength:\n                  \"An entity's string attribute must be 3000 characters or less.\"\n              }\n            },\n            {\n              type: 'boolean',\n              errorMessage: {\n                type:\n                  \"An entity's attribute value must be a string, boolean, or number.\"\n              }\n            },\n            {\n              type: 'number',\n              errorMessage: {\n                type:\n                  \"An entity's attribute value must be a string, boolean, or number.\"\n              }\n            }\n          ],\n          errorMessage: {\n            oneOf:\n              \"An entity's attribute value must be a string, boolean, or number.\"\n          }\n        }\n      },\n      maxProperties: 100,\n      additionalProperties: false,\n      errorMessage: {\n        maxProperties: 'There can only be up to 100 attributes for an entity.',\n        additionalProperties:\n          'Each attribute must begin and end with an alphabet letter (a-z, A-Z). In between, allowed characters are a-z, A-Z, and \"_\". For example: isStudent or is_student. Preceding or trailing underscore is not allowed (i.e., _is_student or is_student_). Each attribute value must be a number, string or boolean.'\n      }\n    },\n    group: {\n      type: ['object', 'null'],\n      properties: {\n        type: {\n          type: 'string',\n          pattern: '^([A-Z][a-zA-Z]*)+$',\n          maxLength: 50,\n          minLength: 1,\n          errorMessage: {\n            type:\n              'Group type must be a string that starts with a capital letter like [C]arGroup or [U]serGroup. Camel casing is used to separate words.',\n            maxLength:\n              'Group type must be a non-empty string of 50 characters or less',\n            minLength:\n              'Group type must be a non-empty string of 50 characters or less'\n          }\n        },\n        isGroup: {\n          type: 'boolean',\n          enum: [true],\n          errorMessage: {\n            type: '`isGroup` must be a boolean',\n            enum: '`isGroup` must always be true for an group'\n          }\n        },\n        id: {\n          type: ['string', 'integer'],\n          pattern: '^[ -~]+$',\n          maxLength: 250,\n          minLength: 1,\n          errorMessage: {\n            type:\n              \"A group's `id` must be a string or integer. An integer `id` will be cast into a string.\",\n            maxLength:\n              \"A group's `id` must be a non-empty string of 250 characters or less.\",\n            minLength:\n              \"A group's `id` must be a non-empty string of 250 characters or less.\"\n          }\n        },\n        displayName: {\n          type: 'string',\n          maxLength: 250,\n          minLength: 1,\n          errorMessage: {\n            type: \"A group's `displayName` must be a string\",\n            maxLength:\n              \"A group's `displayName` must be a non-empty string of 250 characters or less.\",\n            minLength:\n              \"A group's `displayName` must be a non-empty string of 250 characters or less.\"\n          }\n        },\n        attributes: {\n          type: 'object',\n          patternProperties: {\n            '^[a-zA-Z]$|^[a-zA-Z_]{0,48}[a-zA-Z]$': {\n              oneOf: [\n                {\n                  type: 'string',\n                  maxLength: 3000,\n                  errorMessage: {\n                    type:\n                      \"A group's attribute value must be a string, boolean, or number.\",\n                    maxLength:\n                      \"A group's string attribute must be 3000 characters or less.\"\n                  }\n                },\n                {\n                  type: 'boolean',\n                  errorMessage: {\n                    type:\n                      \"A group's attribute value must be a string, boolean, or number.\"\n                  }\n                },\n                {\n                  type: 'number',\n                  errorMessage: {\n                    type:\n                      \"A group's attribute value must be a string, boolean, or number.\"\n                  }\n                }\n              ],\n              errorMessage: {\n                oneOf:\n                  \"A group's attribute value must be a string, boolean, or number.\"\n              }\n            }\n          },\n          maxProperties: 100,\n          additionalProperties: false,\n          errorMessage: {\n            additionalProperties:\n              'Each attribute must begin and end with an alphabet letter (a-z, A-Z). In between, allowed characters are a-z, A-Z, and \"_\". For example: isStudent or is_student. Preceding or trailing underscore is not allowed (i.e., _is_student or is_student_). Each attribute value must be a number, string or boolean.'\n          }\n        }\n      },\n      required: ['id'],\n      additionalProperties: false,\n      errorMessage: {\n        required: 'Each group must have an `id` field.',\n        additionalProperties:\n          'Allowed properties for a group are: `type`, `id`, `displayName`, `attributes`, and `isGroup`. `id` is required, rest are optional.'\n      }\n    }\n  },\n  required: ['id'],\n  additionalProperties: false,\n  errorMessage: {\n    type: 'An entity is represented using a dictionary',\n    required: 'Each entity must have an `id` field.',\n    additionalProperties:\n      'Allowed properties for an entity are: `type`, `id`, `displayName`, `attributes`, `group`, and `isGroup`. `id` is required, rest are optional.'\n  }\n}\n\nconst ajv = Ajv({allErrors: true, jsonPointers: true})\najvErrors(ajv)\nconst validate = ajv.compile(SCHEMA)\n\nexport const DEFAULT_ENTITY_TYPE = 'User'\n\nexport default class AirshipObject {\n  constructor(obj) {\n    let isValid = AirshipObject.isValidObject(obj)\n\n    if (!isValid) {\n      this.object = null\n      return\n    }\n\n    obj = AirshipObject._cloneObject(obj)\n    isValid = AirshipObject._fillInFields(obj)\n\n    if (!isValid) {\n      this.object = null\n      return\n    }\n\n    this.object = obj\n  }\n\n  static isValidObject(obj) {\n    let isValid = validate(obj)\n    if (!isValid) {\n      logger(validate.errors.map(e => e.message))\n    }\n\n    if (isValid) {\n      const isGroup = obj.isGroup !== undefined ? obj.isGroup : false\n      const type = obj.type !== undefined ? obj.type : DEFAULT_ENTITY_TYPE\n\n      const groupIndex = type.lastIndexOf('Group')\n      if (\n        groupIndex !== -1 &&\n        groupIndex === type.length - 'Group'.length &&\n        !isGroup\n      ) {\n        logger(\n          \"An entity's type that ends with `Group` must be a group entity and therefore has to have an explicit `isGroup: true` property\"\n        )\n        isValid = false\n      }\n    }\n\n    return isValid\n  }\n\n  static _cloneObject(obj) {\n    const clone = Object.assign({}, obj)\n\n    if (obj.attributes !== undefined) {\n      clone.attributes = Object.assign({}, obj.attributes)\n    }\n\n    if (obj.group !== undefined) {\n      clone.group = Object.assign({}, obj.group)\n\n      if (obj.group.attributes !== undefined) {\n        clone.group.attributes = Object.assign({}, obj.group.attributes)\n      }\n    }\n\n    return clone\n  }\n\n  static _fillInFields(obj) {\n    if (obj.type === undefined) {\n      obj.type = DEFAULT_ENTITY_TYPE\n    }\n\n    if (obj.displayName === undefined) {\n      obj.displayName = '' + obj.id\n    }\n\n    if (obj.isGroup === undefined) {\n      obj.isGroup = false\n    }\n\n    if (Number.isInteger(obj.id)) {\n      const idStr = '' + obj.id\n      if (idStr.length > 250) {\n        logger('Integer id must have 250 digits or less')\n        return false\n      }\n      obj.id = idStr\n    }\n\n    let group = null\n    if (obj.group !== undefined) {\n      group = obj.group\n    }\n\n    if (group !== null && group.displayName === undefined) {\n      group.displayName = '' + group.id\n    }\n\n    if (group !== null && group.type === undefined) {\n      group.type = obj.type + 'Group'\n    }\n\n    if (group !== null) {\n      group.isGroup = true\n    }\n\n    if (group !== null) {\n      if (Number.isInteger(group.id)) {\n        const idStr = '' + group.id\n        if (idStr.length > 250) {\n          logger('Integer id must have 250 digits or less')\n          return false\n        }\n        group.id = idStr\n      }\n    }\n\n    return true\n  }\n\n  getHash() {\n    return md5(\n      stringify({\n        ...this.object,\n        attributes: this.object.attributes || {},\n        group: {\n          ...this.object.group,\n          attributes: (this.object.group && this.object.group.attributes) || {}\n        }\n      })\n    )\n  }\n\n  getId() {\n    const obj = this.object\n    return `${obj.type}_${obj.id}`\n  }\n\n  isValid() {\n    return this.object !== null\n  }\n\n  getRawObject() {\n    return this.object\n  }\n\n  getObject() {\n    const obj = this.object\n    const clone = Object.assign({}, obj)\n    delete clone.group\n    return new AirshipObject(clone)\n  }\n\n  getGroup() {\n    const group = this.object.group || null\n    return group && new AirshipObject(group)\n  }\n}\n","import md5 from 'md5'\nimport {logger} from './logger'\n\nexport const RULE_TYPE_STRING = 'string'\nexport const RULE_TYPE_INT = 'int'\nexport const RULE_TYPE_FLOAT = 'float'\nexport const RULE_TYPE_BOOLEAN = 'boolean'\nexport const RULE_TYPE_DATE = 'date'\nexport const RULE_TYPE_DATETIME = 'datetime'\n\nexport const RULE_OPERATOR_IS = 'is'\nexport const RULE_OPERATOR_IS_NOT = 'is_not'\nexport const RULE_OPERATOR_IN = 'in'\nexport const RULE_OPERATOR_NOT_IN = 'not_in'\nexport const RULE_OPERATOR_LT = 'lt'\nexport const RULE_OPERATOR_LTE = 'lte'\nexport const RULE_OPERATOR_GT = 'gt'\nexport const RULE_OPERATOR_GTE = 'gte'\nexport const RULE_OPERATOR_FROM = 'from'\nexport const RULE_OPERATOR_UNTIL = 'until'\nexport const RULE_OPERATOR_AFTER = 'after'\nexport const RULE_OPERATOR_BEFORE = 'before'\n\nexport const getHashedValue = s => {\n  return (parseInt(md5(s), 16) * 1.0) / 340282366920938463463374607431768211455\n}\n\nexport default class Population {\n  constructor(population) {\n    this.population = population\n  }\n\n  static categorizeValueType(v) {\n    if (v === true || v === false) {\n      return 'boolean'\n    } else if (typeof v === 'number') {\n      if ((v + '').indexOf('.') >= 0) {\n        return 'float'\n      } else {\n        return 'int'\n      }\n    } else if (typeof v === 'string') {\n      const unixTimestamp = new Date(v).getTime()\n\n      if (!isNaN(unixTimestamp)) {\n        const isoFormat = new Date(v).toISOString()\n        const timeIndex = isoFormat.lastIndexOf('T00:00:00.000Z')\n        if (\n          timeIndex !== -1 &&\n          isoFormat.length - 'T00:00:00.000Z'.length === timeIndex\n        ) {\n          return 'date'\n        } else {\n          return 'datetime'\n        }\n      }\n\n      return 'string'\n    }\n    logger('Unexpected attribute value type encountered')\n    return null\n  }\n\n  _ruleMatches(rule, obj) {\n    const attributes = obj.attributes || {}\n\n    if (!attributes.hasOwnProperty(rule.attributeName)) {\n      return false\n    }\n\n    const v = attributes[rule.attributeName]\n    const attributeType = Population.categorizeValueType(v)\n\n    const numberTypes = [RULE_TYPE_INT, RULE_TYPE_FLOAT]\n\n    if (\n      numberTypes.indexOf(attributeType) !== -1 &&\n      numberTypes.indexOf(rule.attributeType) !== -1\n    ) {\n      // This is fine\n    } else if (attributeType !== rule.attributeType) {\n      return false\n    }\n\n    const targetVal = rule.value\n    const targetValList = rule.valueList\n    const op = rule.operator\n\n    if (attributeType === RULE_TYPE_STRING) {\n      if (op === RULE_OPERATOR_IS) {\n        return v === targetVal\n      } else if (op === RULE_OPERATOR_IS_NOT) {\n        return v !== targetVal\n      } else if (op === RULE_OPERATOR_IN) {\n        return targetValList.indexOf(v) !== -1\n      } else if (op === RULE_OPERATOR_NOT_IN) {\n        return targetValList.indexOf(v) === -1\n      } else {\n        logger('Invalid rule operator encountered')\n        return false\n      }\n    } else if (numberTypes.indexOf(attributeType) !== -1) {\n      if (op === RULE_OPERATOR_IS) {\n        return v === targetVal\n      } else if (op === RULE_OPERATOR_IS_NOT) {\n        return v !== targetVal\n      } else if (op === RULE_OPERATOR_IN) {\n        return targetValList.indexOf(v) !== -1\n      } else if (op === RULE_OPERATOR_NOT_IN) {\n        return targetValList.indexOf(v) === -1\n      } else if (op === RULE_OPERATOR_LT) {\n        return v < targetVal\n      } else if (op === RULE_OPERATOR_LTE) {\n        return v <= targetVal\n      } else if (op === RULE_OPERATOR_GT) {\n        return v > targetVal\n      } else if (op === RULE_OPERATOR_GTE) {\n        return v >= targetVal\n      } else {\n        logger('Invalid rule operator encountered')\n        return false\n      }\n    } else if (attributeType === RULE_TYPE_BOOLEAN) {\n      if (op === RULE_OPERATOR_IS) {\n        return v === targetVal\n      } else if (op === RULE_OPERATOR_IS_NOT) {\n        return v !== targetVal\n      } else {\n        logger('Invalid rule operator encountered')\n        return false\n      }\n    } else if (\n      attributeType === RULE_TYPE_DATE ||\n      attributeType === RULE_TYPE_DATETIME\n    ) {\n      const targetTime = targetVal && new Date(targetVal).getTime()\n      const targetTimeList =\n        targetValList && targetValList.map(tv => new Date(tv).getTime())\n      const vTime = new Date(v).getTime()\n\n      if (op === RULE_OPERATOR_IS) {\n        return vTime === targetTime\n      } else if (op === RULE_OPERATOR_IS_NOT) {\n        return vTime !== targetTime\n      } else if (op === RULE_OPERATOR_IN) {\n        return targetTimeList.indexOf(vTime) !== -1\n      } else if (op === RULE_OPERATOR_NOT_IN) {\n        return targetTimeList.indexOf(vTime) === -1\n      } else if (op === RULE_OPERATOR_FROM) {\n        return vTime >= targetTime\n      } else if (op === RULE_OPERATOR_UNTIL) {\n        return vTime <= targetTime\n      } else if (op === RULE_OPERATOR_AFTER) {\n        return vTime > targetTime\n      } else if (op === RULE_OPERATOR_BEFORE) {\n        return vTime < targetTime\n      } else {\n        logger('Invalid rule operator encountered')\n        return false\n      }\n    } else {\n      logger('Invalid attribute type encountered')\n      return false\n    }\n  }\n\n  getGateValues(obj, env, flag, sticky) {\n    const population = this.population\n    if (this.population.entityType !== obj.type) {\n      return {eligible: false}\n    }\n\n    const splits = sticky\n      ? this.population.universes[\n          Math.floor(parseInt(this.population.percentage * 100)) - 1\n        ]\n      : flag.splits\n    const splitsMap = {}\n    for (let i = 0; i < splits.length; i++) {\n      const split = splits[i]\n      splitsMap[split.treatmentId] = split\n    }\n\n    const rules = population.rules\n\n    let matches = true\n\n    for (let i = 0; i < rules.length; i++) {\n      const r = rules[i]\n      matches = matches && this._ruleMatches(r, obj)\n    }\n\n    if (matches) {\n      const samplingHashKey = `SAMPLING:control_${flag.hashKey}:env_${\n        env.hashKey\n      }:rule_set_${this.population.hashKey}:client_object_${obj.type}_${obj.id}`\n\n      if (getHashedValue(samplingHashKey) <= this.population.percentage) {\n        if (this.population.percentage === 0) {\n          return {eligible: false}\n        }\n\n        const allocationHashKey = `DISTRIBUTION:control_${flag.hashKey}:env_${\n          env.hashKey\n        }:client_object_${obj.type}_${obj.id}`\n\n        const allocationHashedPercentage = getHashedValue(allocationHashKey)\n\n        let trailingSum = 0.0\n\n        const treatments = flag.treatments.filter(t => !t.isOffTreatment)\n\n        let treatment = null\n        for (let i = 0; i < treatments.length; i++) {\n          const t = treatments[i]\n          if (splitsMap.hasOwnProperty(t.treatmentId)) {\n            trailingSum = parseFloat(\n              (trailingSum + splitsMap[t.treatmentId].percentage).toFixed(3)\n            )\n\n            if (allocationHashedPercentage <= trailingSum) {\n              treatment = t\n              break\n            }\n          }\n        }\n\n        return {treatment: treatment, eligible: true}\n      } else {\n        return {eligible: true}\n      }\n    } else {\n      return {eligible: false}\n    }\n  }\n}\n","const NS_PER_SEC = 1e9\n\nexport default class Stat {\n  static compactStats(stats) {\n    const groups = stats.reduce((groups, stat) => {\n      const key = [stat.name, stat.type].join(',')\n      groups[key] = groups[key] || []\n      groups[key].push(stat)\n      return groups\n    }, {})\n\n    return Object.values(groups).map(stats => {\n      const newStat = new Stat(stats[0].name, stats[0].type)\n      switch (newStat.type) {\n        case Stat.TYPE_DURATION:\n          const totalDuration = stats.reduce(\n            (duration, stat) => duration + stat.averageDuration * stat.count,\n            0\n          )\n          const totalCount = stats.reduce(\n            (count, stat) => count + stat.count,\n            0\n          )\n          newStat.setAverageDuration(totalDuration / totalCount)\n          newStat.setCount(totalCount)\n          break\n        case Stat.TYPE_COUNT:\n          newStat.setCount(stats.reduce((count, stat) => count + stat.count, 0))\n          break\n      }\n      return newStat\n    })\n  }\n\n  constructor(name, type) {\n    const allowedTypes = [Stat.TYPE_DURATION, Stat.TYPE_COUNT]\n    if (allowedTypes.indexOf(type) === -1) {\n      throw 'Invalid stat type passed'\n    }\n    this.name = name\n    this.type = type\n\n    this.count = 0\n    this.startTime = null\n\n    this.averageDuration = 0\n  }\n\n  start() {\n    if (this.averageDuration !== 0) {\n      throw 'Duration already calculated'\n    }\n\n    if (this.startTime !== null) {\n      throw 'Stat start() already called'\n    }\n\n    this.startTime = process.hrtime()\n    return this\n  }\n\n  stop() {\n    if (this.averageDuration !== 0) {\n      throw 'Duration already calculated'\n    }\n\n    if (this.startTime === null) {\n      throw 'Stat start() has not been called'\n    }\n\n    const stopTime = process.hrtime(this.startTime)\n    this.averageDuration = stopTime[0] * NS_PER_SEC + stopTime[1]\n    this.count = 1\n    return this\n  }\n\n  setCount(n) {\n    this.count = n\n    return this\n  }\n\n  setAverageDuration(t) {\n    this.averageDuration = t\n    return this\n  }\n\n  getDuration() {\n    return this.averageDuration\n  }\n\n  getStatsObj() {\n    const statsObj = {\n      name: this.name\n    }\n    if (this.type === Stat.TYPE_DURATION) {\n      if (this.averageDuration !== 0) {\n        statsObj.duration = this.averageDuration\n        statsObj.unit = 'ns'\n        statsObj.count = this.count\n        return statsObj\n      }\n    } else if (this.type === Stat.TYPE_COUNT) {\n      statsObj.count = this.count\n      return statsObj\n    }\n    return null\n  }\n}\n\nStat.TYPE_DURATION = 'stat_type__duration'\nStat.TYPE_COUNT = 'stat_type__count'\n","import {logger} from './logger'\nimport AirshipObject from './object'\nimport Population from './population'\nimport Stat from './stat'\n\nexport default class Environment {\n  identify(obj) {\n    this.object = obj\n  }\n\n  async maybeIngest() {}\n\n  _identifyObject(obj) {\n    const airshipObj =\n      obj instanceof AirshipObject ? obj : new AirshipObject(obj)\n\n    return airshipObj\n  }\n\n  _saveStat() {}\n\n  _saveExposure() {}\n\n  async publish(objs) {}\n\n  shutdown() {}\n\n  flag(flagName) {\n    const flag = this.router.getFlag(flagName)\n    flag.setDelegate(this)\n    return flag\n  }\n\n  _getAllocation(flag, airshipObj) {\n    const offTreatment = flag.offTreatment\n\n    if (flag.isArchived()) {\n      logger(`The flag \"${flag.codename}\" has been archived`)\n      return {\n        treatment: offTreatment,\n        eligible: false\n      }\n    }\n\n    if (flag.isPaused) {\n      return {\n        treatment: offTreatment,\n        eligible: false\n      }\n    }\n\n    // If the airshipObj is not a valid obj,\n    // then return the offTreatment/false\n    if (!airshipObj) {\n      return {\n        treatment: offTreatment,\n        eligible: false\n      }\n    }\n\n    const id = airshipObj.getId()\n    const override = flag.overrides[id]\n\n    if (override) {\n      const treatment = flag.treatmentsMap[override.treatmentId]\n      return {\n        treatment: treatment,\n        eligible: !treatment.isOffTreatment,\n        fromOverride: true\n      }\n    }\n\n    const obj = airshipObj.getRawObject()\n    const useUniverses = flag.getType() === 'experiment'\n    const populations = flag.populations\n    let treatment = null\n    let eligible = false\n\n    for (let i = 0; i < populations.length; i++) {\n      const p = new Population(populations[i])\n      const gateValues = p.getGateValues(\n        obj,\n        this.router.getEnv(),\n        flag,\n        useUniverses\n      )\n      eligible = eligible || gateValues.eligible\n      if (gateValues.treatment) {\n        treatment = gateValues.treatment\n        break\n      }\n    }\n\n    return {\n      treatment: treatment || offTreatment,\n      eligible: eligible\n    }\n  }\n\n  _resolveAllocations(alloc1, alloc2) {\n    if (alloc1.fromOverride) {\n      return alloc1\n    }\n\n    if (alloc2.fromOverride) {\n      return alloc2\n    }\n\n    if (!alloc1.treatment.isOffTreatment) {\n      return alloc1\n    }\n\n    if (!alloc2.treatment.isOffTreatment) {\n      return alloc2\n    }\n\n    return alloc1\n  }\n\n  _getExposure(airshipObj, alloc) {\n    const obj = airshipObj.getRawObject()\n    return {\n      type: obj.type,\n      id: obj.id,\n      treatmentId: alloc.treatment.treatmentId,\n      treatment: alloc.treatment.codename\n    }\n  }\n\n  getTreatment(flag, obj) {\n    const stat = new Stat('duration__get_treatment', Stat.TYPE_DURATION)\n    stat.start()\n    obj = obj || this.object\n\n    const airshipObj = this._identifyObject(obj)\n    if (!airshipObj.isValid() || flag.isUncategorized()) {\n      return 'off'\n    }\n\n    const allocation = this._getAllocation(flag, airshipObj)\n    const groupAllocation = this._getAllocation(flag, airshipObj.getGroup())\n\n    const finalAllocation = this._resolveAllocations(\n      allocation,\n      groupAllocation\n    )\n\n    const expo = this._getExposure(airshipObj, finalAllocation)\n    this._saveExposure(expo)\n\n    stat.stop()\n    this._saveStat(stat)\n    return finalAllocation.treatment.codename\n  }\n\n  getPayload(flag, obj) {\n    const stat = new Stat('duration__get_payload', Stat.TYPE_DURATION)\n    stat.start()\n    obj = obj || this.object\n    const airshipObj = this._identifyObject(obj)\n    if (!airshipObj.isValid() || flag.isUncategorized()) {\n      return null\n    }\n\n    const allocation = this._getAllocation(flag, airshipObj)\n    const groupAllocation = this._getAllocation(flag, airshipObj.getGroup())\n\n    const finalAllocation = this._resolveAllocations(\n      allocation,\n      groupAllocation\n    )\n\n    stat.stop()\n    this._saveStat(stat)\n    return finalAllocation.treatment.payload\n  }\n\n  isEligible(flag, obj) {\n    const stat = new Stat('duration__is_eligible', Stat.TYPE_DURATION)\n    stat.start()\n    obj = obj || this.object\n\n    const airshipObj = this._identifyObject(obj)\n    if (!airshipObj.isValid() || flag.isUncategorized()) {\n      return false\n    }\n\n    const allocation = this._getAllocation(flag, airshipObj)\n    const groupAllocation = this._getAllocation(flag, airshipObj.getGroup())\n\n    const finalAllocation = this._resolveAllocations(\n      allocation,\n      groupAllocation\n    )\n\n    stat.stop()\n    this._saveStat(stat)\n    return finalAllocation.eligible\n  }\n\n  isEnabled(flag, obj) {\n    const stat = new Stat('duration__is_enabled', Stat.TYPE_DURATION)\n    stat.start()\n    obj = obj || this.object\n\n    const airshipObj = this._identifyObject(obj)\n    if (!airshipObj.isValid() || flag.isUncategorized()) {\n      return false\n    }\n\n    const allocation = this._getAllocation(flag, airshipObj)\n    const groupAllocation = this._getAllocation(flag, airshipObj.getGroup())\n\n    const finalAllocation = this._resolveAllocations(\n      allocation,\n      groupAllocation\n    )\n\n    stat.stop()\n    this._saveStat(stat)\n    return !finalAllocation.treatment.isOffTreatment\n  }\n}\n","// Based on https://chrisrng.svbtle.com/lru-cache-in-javascript\nclass LRUNode {\n  constructor(key, value) {\n    if (typeof key === 'undefined' || key === null) {\n      throw 'Cannot have an undefined or null key for a LRUNode'\n    }\n    if (typeof value === 'undefined' || value === null) {\n      throw 'Cannot have an undefined or null value for a LRUNode'\n    }\n    this.key = key\n    this.value = value\n    this.prev = null\n    this.next = null\n  }\n}\n\nexport default class LRU {\n  constructor(limit) {\n    this.size = 0\n    if (typeof limit === 'number') {\n      this.limit = limit\n    } else {\n      this.limit = 10\n    }\n    this.map = {}\n    this.head = null\n    this.tail = null\n  }\n\n  setHead(node) {\n    node.next = this.head\n    node.prev = null\n    if (this.head !== null) {\n      this.head.prev = node\n    }\n    this.head = node\n    if (this.tail === null) {\n      this.tail = node\n    }\n    this.size++\n    this.map[node.key] = node\n  }\n\n  set(key, value) {\n    const node = new LRUNode(key, value)\n    if (this.map[key]) {\n      this.map[key].value = node.value\n      this.remove(node.key)\n    } else {\n      if (this.size >= this.limit) {\n        delete this.map[this.tail.key]\n        this.size--\n        this.tail = this.tail.prev\n        this.tail.next = null\n      }\n    }\n    this.setHead(node)\n  }\n\n  get(key) {\n    if (this.map[key]) {\n      const value = this.map[key].value\n      const node = new LRUNode(key, value)\n      this.remove(key)\n      this.setHead(node)\n      return value\n    } else {\n      // console.log('Key ' + key + ' does not exist in the cache.')\n      return null // Return null because null cannot be a LRUNode value\n    }\n  }\n\n  remove(key) {\n    const node = this.map[key]\n    if (node.prev !== null) {\n      node.prev.next = node.next\n    } else {\n      this.head = node.next\n    }\n    if (node.next !== null) {\n      node.next.prev = node.prev\n    } else {\n      this.tail = node.prev\n    }\n    delete this.map[key]\n    this.size--\n  }\n\n  removeAll(limit) {\n    this.size = 0\n    this.map = {}\n    this.head = null\n    this.tail = null\n    if (typeof limit === 'number') {\n      this.limit = limit\n    }\n  }\n\n  forEach(callback) {\n    let node = this.head\n    let i = 0\n    while (node) {\n      callback(node, i)\n      i++\n      node = node.next\n    }\n  }\n}\n","import {logger} from './logger'\n\nexport default class Flag {\n  constructor(flag, delegate) {\n    if (typeof flag === 'string') {\n      this._isWild = true\n      this.flagName = flag\n    } else {\n      // These along with flag.flagType and flag.flagStatus\n      // should always be present\n      this.hashKey = flag.hashKey\n      this.flag = flag\n      this.codename = flag.codename\n\n      // Pass through fields\n      this.isPaused = flag.isPaused\n      this.offTreatment = flag.offTreatment\n      this.treatments = flag.treatments\n      this.treatmentsMap = flag.treatmentsMap\n      this.overrides = flag.overrides\n      this.populations = flag.populations\n      this.splits = flag.splits\n    }\n    this.delegate = delegate\n  }\n\n  isUncategorized() {\n    return Boolean(this._isWild) || this.flag.flagType === 'uncategorized'\n  }\n\n  isWild() {\n    return Boolean(this._isWild)\n  }\n\n  isArchived() {\n    return this.flag.flagStatus === 'archived'\n  }\n\n  setDelegate(delegate) {\n    this.delegate = delegate\n  }\n\n  getType() {\n    if (this._isWild) {\n      logger(\n        `Encountered uncategorized flag \"${\n          this.flagName\n        }\". Visit Airship web app to convert it to a real flag`\n      )\n      return 'uncategorized'\n    }\n\n    const flagType = this.flag.flagType\n\n    switch (flagType) {\n      case 'basic':\n        return 'basic'\n      case 'experiment':\n        return 'experiment'\n      case 'uncategorized':\n        return 'uncategorized'\n      default:\n        logger('Unexpected flag type encountered')\n        return null\n    }\n  }\n\n  getTreatment(obj) {\n    if (!this.delegate) {\n      throw 'Delegate not provided to flag'\n    }\n    return this.delegate.getTreatment(this, obj)\n  }\n\n  getPayload(obj) {\n    if (!this.delegate) {\n      throw 'Delegate not provided to flag'\n    }\n    return this.delegate.getPayload(this, obj)\n  }\n\n  isEligible(obj) {\n    if (!this.delegate) {\n      throw 'Delegate not provided to flag'\n    }\n    return this.delegate.isEligible(this, obj)\n  }\n\n  isEnabled(obj) {\n    if (!this.delegate) {\n      throw 'Delegate not provided to flag'\n    }\n    return this.delegate.isEnabled(this, obj)\n  }\n}\n","import Flag from './flag'\n\nexport default class Router {\n  constructor(gatingInfo) {\n    this.gatingInfo = gatingInfo\n    this.gatingInfoMap = this._getGatingInfoMap(this.gatingInfo)\n  }\n\n  _getGatingInfoMap(gatingInfo) {\n    const map = {}\n\n    const flags = gatingInfo.flags\n\n    for (let i = 0; i < flags.length; i++) {\n      const flag = Object.assign({}, flags[i])\n      if (flag.flagType === 'uncategorized' || flag.flagStatus === 'archived') {\n        map[flag.codename] = new Flag(flag)\n        continue\n      }\n\n      const overrides = flag.overrides\n      const overridesMap = {}\n\n      for (let j = 0; j < overrides.length; j++) {\n        const override = overrides[j]\n\n        overridesMap[`${override.entityType}_${override.entityId}`] = override\n      }\n\n      flag.overrides = overridesMap\n\n      const treatments = flag.treatments\n      const treatmentsMap = {}\n      let offTreatment = null\n\n      for (let k = 0; k < treatments.length; k++) {\n        const treatment = treatments[k]\n\n        treatmentsMap[treatment.treatmentId] = treatment\n\n        if (treatment.isOffTreatment) {\n          offTreatment = treatment\n        }\n      }\n\n      flag.treatments = treatments\n      flag.treatmentsMap = treatmentsMap\n      flag.offTreatment = offTreatment\n\n      map[flag.codename] = new Flag(flag)\n    }\n\n    return map\n  }\n\n  getIngestionMaxItem() {\n    const sdkInfo = this.gatingInfo.sdkInfo\n    if (sdkInfo) {\n      return sdkInfo.SDK_INGESTION_MAX_ITEMS\n    }\n    return null\n  }\n\n  getIngestionInterval() {\n    const sdkInfo = this.gatingInfo.sdkInfo\n    if (sdkInfo) {\n      return sdkInfo.SDK_INGESTION_INTERVAL * 1000\n    }\n    return null\n  }\n\n  getFlag(flagName) {\n    return this.gatingInfoMap[flagName] || new Flag(flagName)\n  }\n\n  getEnv() {\n    return this.gatingInfo.env\n  }\n\n  isLocallyConfigured() {\n    return this.getEnv().envKey === null\n  }\n}\n","import {logger} from '../logger'\nimport Ajv from 'ajv'\nimport ajvErrors from 'ajv-errors'\n\nconst SCHEMA = {\n  type: 'object',\n  patternProperties: {\n    '^.{1,150}$': {\n      type: 'object',\n      properties: {\n        whitelist: {\n          type: 'array',\n          items: {\n            type: ['integer', 'string'],\n            errorMessage: {\n              type:\n                'An ID can be a string or integer. Integer ID will be cast into a string.'\n            }\n          },\n          errorMessage: {\n            type: '`whitelist` must be an array of IDs (string|integer)'\n          }\n        },\n        blacklist: {\n          type: 'array',\n          items: {\n            type: ['integer', 'string'],\n            errorMessage: {\n              type:\n                'An ID can be a string or integer. Integer ID will be cast into a string.'\n            }\n          },\n          errorMessage: {\n            type: '`blacklist` must be an array of IDs (string|integer)'\n          }\n        },\n        population: {\n          type: 'array',\n          items: {\n            type: 'object',\n            properties: {\n              attribute: {\n                type: 'string',\n                maxLength: 50,\n                errorMessage: {\n                  type:\n                    'A population\\'s filter attribute must be a string of 50 characters or less. E.g., \"age\", \"height\", \"birthDate\", etc.',\n                  maxLength:\n                    'A population\\'s filter attribute must be a string of 50 characters or less. E.g., \"age\", \"height\", \"birthDate\", etc.'\n                }\n              },\n              operator: {\n                type: 'string',\n                enum: [\n                  'is',\n                  'is_not',\n                  'in',\n                  'not_in',\n                  'lt',\n                  'lte',\n                  'gt',\n                  'gte',\n                  'from',\n                  'until',\n                  'after',\n                  'before'\n                ],\n                errorMessage: {\n                  type:\n                    'A population\\'s filter operator must be a string and must be one of: [\"is\", \"is_not\", \"in\", \"not_in\", \"lt\", \"lte\", \"gt\", \"gte\", \"from\", \"until\", \"after\", \"before\"]',\n                  enum:\n                    'A population\\'s filter operator must be a string and must be one of: [\"is\", \"is_not\", \"in\", \"not_in\", \"lt\", \"lte\", \"gt\", \"gte\", \"from\", \"until\", \"after\", \"before\"]'\n                }\n              },\n              value: {\n                type: ['number', 'string', 'boolean', 'array'],\n                maxLength: 3000,\n                items: {\n                  oneOf: [\n                    {\n                      type: 'number',\n                      errorMessage: {\n                        type:\n                          \"A population's filter valueList must contain numbers or strings.\"\n                      }\n                    },\n                    {\n                      type: 'string',\n                      maxLength: 3000,\n                      errorMessage: {\n                        maxLength:\n                          'A string value for a population filter must be 3000 characters or less'\n                      }\n                    }\n                  ]\n                },\n                minItems: 1,\n                errorMessage: {\n                  type:\n                    \"A population's filter value is a number, string, or boolean or an array of numbers or strings.\",\n                  maxLength:\n                    'A string value for a population filter must be 3000 characters or less',\n                  minItems:\n                    \"A population's filter value must have at least one item if it is an array.\"\n                }\n              }\n            },\n            errorMessage: {\n              type:\n                'Each filter within a population is represented by an object of the form: {attribute: <attribute>, operator: <operator>, value/valueList: <value>/<valueList>}'\n            }\n          },\n          errorMessage: {\n            type:\n              '`population` must be an array of filters, each of the form: {attribute: <attribute>, operator: <operator>, value/valueList: <value>/<valueList>}'\n          }\n        },\n        sample: {\n          type: 'number',\n          minimum: 0.0,\n          maximum: 1.0,\n          errorMessage: {\n            type: '`sample` must be a float between 0.0 and 1.0, inclusive',\n            minimum: '`sample` must be between 0.0 and 1.0, inclusive',\n            maximum: '`sample` must be between 0.0 and 1.0, inclusive'\n          }\n        },\n        active: {\n          type: 'boolean',\n          errorMessage: {\n            type: '`active` must be a boolean'\n          }\n        }\n      },\n      additionalProperties: false,\n      errorMessage: {\n        type:\n          'flagConfig must be a dictionary of flag name keys to flag configuration values',\n        additionalProperties:\n          'Unexpected config option found. Please refer to the documentation.'\n      }\n    }\n  },\n  errorMessage: {\n    patternProperties: 'Flag name must be strings of up to 150 characters.'\n  }\n}\n\nconst ajv = Ajv({allErrors: true, jsonPointers: true})\najvErrors(ajv)\nconst validate = ajv.compile(SCHEMA)\n\nexport const isValidFlagConfig = flagConfig => {\n  const isValid = validate(flagConfig)\n  if (!isValid) {\n    logger(validate.errors.map(e => e.message))\n  }\n  return isValid\n}\n","import {logger} from '../logger'\nimport {isValidFlagConfig} from '../validators/core_validator'\nimport Population, {\n  RULE_TYPE_STRING,\n  RULE_TYPE_INT,\n  RULE_TYPE_FLOAT,\n  RULE_TYPE_BOOLEAN,\n  RULE_TYPE_DATE,\n  RULE_TYPE_DATETIME,\n  RULE_OPERATOR_IS,\n  RULE_OPERATOR_IS_NOT,\n  RULE_OPERATOR_IN,\n  RULE_OPERATOR_NOT_IN,\n  RULE_OPERATOR_LT,\n  RULE_OPERATOR_LTE,\n  RULE_OPERATOR_GT,\n  RULE_OPERATOR_GTE,\n  RULE_OPERATOR_FROM,\n  RULE_OPERATOR_UNTIL,\n  RULE_OPERATOR_AFTER,\n  RULE_OPERATOR_BEFORE\n} from '../population'\n\nconst RULE_TYPE_TO_ALLOWED_OPERATORS = {\n  [RULE_TYPE_STRING]: new Set([\n    RULE_OPERATOR_IS,\n    RULE_OPERATOR_IS_NOT,\n    RULE_OPERATOR_IN,\n    RULE_OPERATOR_NOT_IN\n  ]),\n  [RULE_TYPE_INT]: new Set([\n    RULE_OPERATOR_IS,\n    RULE_OPERATOR_IS_NOT,\n    RULE_OPERATOR_IN,\n    RULE_OPERATOR_NOT_IN,\n    RULE_OPERATOR_LT,\n    RULE_OPERATOR_LTE,\n    RULE_OPERATOR_GT,\n    RULE_OPERATOR_GTE\n  ]),\n  [RULE_TYPE_FLOAT]: new Set([\n    RULE_OPERATOR_IS,\n    RULE_OPERATOR_IS_NOT,\n    RULE_OPERATOR_IN,\n    RULE_OPERATOR_NOT_IN,\n    RULE_OPERATOR_LT,\n    RULE_OPERATOR_LTE,\n    RULE_OPERATOR_GT,\n    RULE_OPERATOR_GTE\n  ]),\n  [RULE_TYPE_BOOLEAN]: new Set([RULE_OPERATOR_IS, RULE_OPERATOR_IS_NOT]),\n  [RULE_TYPE_DATE]: new Set([\n    RULE_OPERATOR_IS,\n    RULE_OPERATOR_IS_NOT,\n    RULE_OPERATOR_IN,\n    RULE_OPERATOR_NOT_IN,\n    RULE_OPERATOR_FROM,\n    RULE_OPERATOR_UNTIL,\n    RULE_OPERATOR_AFTER,\n    RULE_OPERATOR_BEFORE\n  ]),\n  [RULE_TYPE_DATETIME]: new Set([\n    RULE_OPERATOR_IS,\n    RULE_OPERATOR_IS_NOT,\n    RULE_OPERATOR_IN,\n    RULE_OPERATOR_NOT_IN,\n    RULE_OPERATOR_FROM,\n    RULE_OPERATOR_UNTIL,\n    RULE_OPERATOR_AFTER,\n    RULE_OPERATOR_BEFORE\n  ])\n}\n\nexport const transformFlagConfig = flagConfig => {\n  if (!isValidFlagConfig(flagConfig)) {\n    return null\n  }\n\n  const flags = []\n  const keys = Object.keys(flagConfig)\n  for (let i = 0; i < keys.length; i++) {\n    const key = keys[i]\n    const config = flagConfig[key]\n    const active = config.active !== undefined ? config.active : true\n    const flagInfo = {\n      flagType: 'basic',\n      hashKey: key,\n      isPaused: !active,\n      isWebAccessible: __BROWSER__,\n      codename: key,\n      flagStatus: 'operational'\n    }\n    const whitelist = config.whitelist || []\n    const blacklist = config.blacklist || []\n    const blacklistSet = new Set(blacklist)\n    const filteredWhitelist = whitelist.filter(i => !blacklistSet.has(i))\n\n    flagInfo.treatments = [\n      {\n        treatmentId: 'off-treatment',\n        codename: 'off',\n        isControl: false,\n        isOffTreatment: true\n      },\n      {\n        treatmentId: 'on-treatment',\n        codename: 'on',\n        isControl: false,\n        isOffTreatment: false\n      }\n    ]\n\n    flagInfo.overrides = []\n\n    flagInfo.overrides = flagInfo.overrides.concat(\n      filteredWhitelist.map(i => ({\n        treatmentId: 'on-treatment',\n        entityType: 'User',\n        entityId: i.toString()\n      }))\n    )\n\n    flagInfo.overrides = flagInfo.overrides.concat(\n      blacklist.map(i => ({\n        treatmentId: 'off-treatment',\n        entityType: 'User',\n        entityId: i.toString()\n      }))\n    )\n\n    flagInfo.splits = [{treatmentId: 'on-treatment', percentage: 1}]\n\n    if (config.population) {\n      const rules = config.population || []\n      const ruleInfos = []\n\n      for (let j = 0; j < rules.length; j++) {\n        const r = rules[j]\n        let type\n        if (Array.isArray(r.value)) {\n          const types = new Set(\n            r.value.map(v => Population.categorizeValueType(v))\n          )\n\n          if (types.size != 1) {\n            logger(\n              \"Population's filter criteria each should have a singular value type. In other words, do not mix strings with numbers in the same array, for example.\"\n            )\n            return null\n          }\n\n          type = Array.from(types)[0]\n        } else {\n          type = Population.categorizeValueType(r.value)\n        }\n\n        const rInfo = {\n          attributeName: r.attribute,\n          attributeType: type,\n          operator: r.operator,\n          value: !Array.isArray(r.value) ? r.value : null,\n          valueList: !Array.isArray(r.value) ? null : r.value\n        }\n\n        if (!RULE_TYPE_TO_ALLOWED_OPERATORS[type].has(r.operator)) {\n          logger(\n            `Population's filter operator \\`${\n              r.operator\n            }\\` is not allowed for filter type \\`${type}\\``\n          )\n          return null\n        }\n\n        if (rInfo.valueList) {\n          if (\n            rInfo.operator !== RULE_OPERATOR_IN &&\n            rInfo.operator !== RULE_OPERATOR_NOT_IN\n          ) {\n            logger(\n              \"Population's filter operator must be `in` or `not_in` if the value is an array.\"\n            )\n            return null\n          }\n        } else {\n          if (\n            rInfo.operator === RULE_OPERATOR_IN &&\n            rInfo.operator === RULE_OPERATOR_NOT_IN\n          ) {\n            logger(\n              \"Population's filter operator must not be `in` or `not_in` if the value is a number, boolean or string.\"\n            )\n            return null\n          }\n        }\n\n        ruleInfos.push(rInfo)\n      }\n\n      flagInfo.populations = [\n        {\n          hashKey: 'population-1',\n          entityType: 'User',\n          percentage: config.sample || 0.0,\n          rules: ruleInfos,\n          universes: []\n        }\n      ]\n    } else {\n      flagInfo.populations = [\n        {\n          hashKey: 'population-1',\n          entityType: 'User',\n          percentage: config.sample || 0.0,\n          rules: [],\n          universes: []\n        }\n      ]\n    }\n\n    flags.push(flagInfo)\n  }\n\n  return {\n    flags: flags,\n    env: {\n      hashKey: 'env-1',\n      envKey: null\n    }\n  }\n}\n","import Environment from './environment'\nimport Router from './router'\nimport {transformFlagConfig} from './transformers/core_transformer'\n\nexport default class Core extends Environment {\n  async configure(flagConfig) {\n    const gatingInfo = transformFlagConfig(flagConfig)\n    if (gatingInfo === null) {\n      throw 'Failed to transform flagConfig into initial gating information'\n    }\n    this.router = new Router(gatingInfo)\n  }\n}\n","import {setLogger} from './logger'\nimport Airship from './airship'\nimport Core from './core'\n\nconst PLATFORM = 'nodejs'\nconst VERSION = '2.0.0'\n\nconst SDK_VERSION = `${PLATFORM}:${VERSION}`\n\nconst defaultEnv = new Core()\ndefaultEnv.configure({})\n\nexport class FlaggerBase {\n  constructor() {\n    this.gatingInfoListeners = []\n  }\n\n  static _isDict(obj) {\n    return obj !== undefined && obj !== null && obj.constructor === Object\n  }\n\n  async publish(objs) {\n    if (this.environment) {\n      await this.environment.publish(objs)\n    } else {\n      throw 'Airship must be configured first before `publish` can be called'\n    }\n  }\n\n  // This will allow for async/await\n  async configure(options) {\n    if (!FlaggerBase._isDict(options)) {\n      throw '<options> must be dictionary'\n    }\n\n    const envKey = options.envKey\n    const flagConfig = options.flagConfig\n\n    if (!envKey && !flagConfig) {\n      throw '<options> must contain envKey corresponding to an environment key or a flagConfig dictionary'\n    }\n\n    if (envKey) {\n      if (this.environment) {\n        await this.environment.shutdown()\n      }\n      this.environment = new Airship(this.handleGatingInfoUpdate.bind(this))\n      await this.environment.configure(envKey, options.subscribeToUpdates)\n    } else {\n      if (this.environment) {\n        await this.environment.shutdown()\n      }\n      this.environment = new Core()\n      await this.environment.configure(flagConfig)\n    }\n  }\n\n  async shutdown() {\n    if (this.environment) {\n      await this.environment.shutdown()\n      delete this.environment\n    } else {\n      throw 'Airship must be configured first before `shutdown` can be called'\n    }\n  }\n\n  flag(flagName) {\n    return (this.environment || defaultEnv).flag(flagName)\n  }\n\n  setErrorListener(fn) {\n    setLogger(fn)\n  }\n\n  handleGatingInfoUpdate(gatingInfo) {\n    this.gatingInfoListeners.forEach(listener => listener(gatingInfo))\n  }\n\n  addGatingInfoListener(listener) {\n    this.gatingInfoListeners.push(listener)\n  }\n\n  removeGatingInfoListener(listener) {\n    this.gatingInfoListeners = this.gatingInfoListeners.filter(\n      l => l !== listener\n    )\n  }\n\n  identify(obj) {\n    if (this.environment) {\n      this.environment.identify(obj)\n      this.environment._identifyObject(obj)\n      this.environment.maybeIngest(true)\n    } else {\n      throw 'Airship must be configured first before `identify` can be called'\n    }\n  }\n}\n\nconst Flagger = new FlaggerBase()\n\nexport default Flagger\n","import {FlaggerBase} from './index'\n\nexport default class AirshipLegacy {\n  constructor(options) {\n    this.envKey = options.envKey\n    this.airship = new AirshipBase()\n  }\n\n  async init() {\n    console.warn('This method is deprecated. Please refer to v2 documentation.')\n    await this.airship.configure({envKey: this.envKey})\n  }\n\n  isEnabled(controlShortName, object) {\n    console.warn('This method is deprecated. Please refer to v2 documentation.')\n    return this.airship.flag(controlShortName).isEnabled(object)\n  }\n\n  getVariation(controlShortName, object) {\n    console.warn('This method is deprecated. Please refer to v2 documentation.')\n    return this.airship.flag(controlShortName).getTreatment(object)\n  }\n\n  isEligible(controlShortName, object) {\n    console.warn('This method is deprecated. Please refer to v2 documentation.')\n    return this.airship.flag(controlShortName).isEligible(object)\n  }\n}\n\nif (__BROWSER__) {\n  AirshipLegacy.prototype.identify = async function(object) {\n    console.warn('This method is deprecated. Please refer to v2 documentation.')\n    await this.init()\n    this.airship.identify(object)\n  }\n}\n"],"names":["logger","x","console","error","SCHEMA","type","properties","pattern","maxLength","minLength","errorMessage","isGroup","id","displayName","attributes","patternProperties","oneOf","maxProperties","additionalProperties","group","enum","required","ajv","Ajv","allErrors","jsonPointers","ajvErrors","validate","compile","DEFAULT_ENTITY_TYPE","AirshipObject","constructor","obj","isValid","isValidObject","object","_cloneObject","_fillInFields","errors","map","e","message","undefined","groupIndex","lastIndexOf","length","clone","Object","assign","Number","isInteger","idStr","getHash","md5","stringify","getId","getRawObject","getObject","getGroup","RULE_TYPE_STRING","RULE_TYPE_INT","RULE_TYPE_FLOAT","RULE_TYPE_BOOLEAN","RULE_TYPE_DATE","RULE_TYPE_DATETIME","RULE_OPERATOR_IS","RULE_OPERATOR_IS_NOT","RULE_OPERATOR_IN","RULE_OPERATOR_NOT_IN","RULE_OPERATOR_LT","RULE_OPERATOR_LTE","RULE_OPERATOR_GT","RULE_OPERATOR_GTE","RULE_OPERATOR_FROM","RULE_OPERATOR_UNTIL","RULE_OPERATOR_AFTER","RULE_OPERATOR_BEFORE","getHashedValue","s","parseInt","Population","population","categorizeValueType","v","indexOf","unixTimestamp","Date","getTime","isNaN","isoFormat","toISOString","timeIndex","_ruleMatches","rule","hasOwnProperty","attributeName","attributeType","numberTypes","targetVal","value","targetValList","valueList","op","operator","targetTime","targetTimeList","tv","vTime","getGateValues","env","flag","sticky","entityType","eligible","splits","universes","Math","floor","percentage","splitsMap","i","split","treatmentId","rules","matches","r","samplingHashKey","hashKey","allocationHashKey","allocationHashedPercentage","trailingSum","treatments","filter","t","isOffTreatment","treatment","parseFloat","toFixed","NS_PER_SEC","Stat","compactStats","stats","groups","reduce","stat","key","name","join","push","values","newStat","TYPE_DURATION","totalDuration","duration","averageDuration","count","totalCount","setAverageDuration","setCount","TYPE_COUNT","allowedTypes","startTime","start","process","hrtime","stop","stopTime","n","getDuration","getStatsObj","statsObj","unit","Environment","identify","maybeIngest","_identifyObject","airshipObj","_saveStat","_saveExposure","publish","objs","shutdown","flagName","router","getFlag","setDelegate","_getAllocation","offTreatment","isArchived","codename","isPaused","override","overrides","treatmentsMap","fromOverride","useUniverses","getType","populations","p","gateValues","getEnv","_resolveAllocations","alloc1","alloc2","_getExposure","alloc","getTreatment","isUncategorized","allocation","groupAllocation","finalAllocation","expo","getPayload","payload","isEligible","isEnabled","Flag","delegate","_isWild","Boolean","flagType","isWild","flagStatus","Router","gatingInfo","gatingInfoMap","_getGatingInfoMap","flags","overridesMap","j","entityId","k","getIngestionMaxItem","sdkInfo","SDK_INGESTION_MAX_ITEMS","getIngestionInterval","SDK_INGESTION_INTERVAL","isLocallyConfigured","envKey","whitelist","items","blacklist","attribute","minItems","sample","minimum","maximum","active","isValidFlagConfig","flagConfig","RULE_TYPE_TO_ALLOWED_OPERATORS","Set","transformFlagConfig","keys","config","flagInfo","isWebAccessible","blacklistSet","filteredWhitelist","has","isControl","concat","toString","ruleInfos","Array","isArray","types","size","from","rInfo","Core","configure","defaultEnv","AirshipLegacy","options","airship","AirshipBase","init","warn","controlShortName","getVariation"],"mappings":";;;;;;;;;;;AAAO,IAAIA,MAAM,GAAGC,CAAC,IAAI;EACvBC,OAAO,CAACC,KAAR,CAAcF,CAAd;CADK;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACMP,MAAMG,MAAM,GAAG;EACbC,IAAI,EAAE,QADO;EAEbC,UAAU,EAAE;IACVD,IAAI,EAAE;MACJA,IAAI,EAAE,QADF;MAEJE,OAAO,EAAE,qBAFL;MAGJC,SAAS,EAAE,EAHP;MAIJC,SAAS,EAAE,CAJP;MAKJC,YAAY,EAAE;QACZL,IAAI,EACF,qFAFU;QAGZG,SAAS,EACP,iEAJU;QAKZC,SAAS,EACP;;KAZI;IAeVE,OAAO,EAAE;MACPN,IAAI,EAAE,SADC;MAEPK,YAAY,EAAE;QACZL,IAAI,EAAE;;KAlBA;IAqBVO,EAAE,EAAE;MACFP,IAAI,EAAE,CAAC,QAAD,EAAW,SAAX,CADJ;MAEFE,OAAO,EAAE,UAFP;MAGFC,SAAS,EAAE,GAHT;MAIFC,SAAS,EAAE,CAJT;MAKFC,YAAY,EAAE;QACZL,IAAI,EACF,2FAFU;QAGZG,SAAS,EACP,wEAJU;QAKZC,SAAS,EACP;;KAhCI;IAmCVI,WAAW,EAAE;MACXR,IAAI,EAAE,QADK;MAEXG,SAAS,EAAE,GAFA;MAGXC,SAAS,EAAE,CAHA;MAIXC,YAAY,EAAE;QACZL,IAAI,EAAE,4CADM;QAEZG,SAAS,EACP,iFAHU;QAIZC,SAAS,EACP;;KA5CI;IA+CVK,UAAU,EAAE;MACVT,IAAI,EAAE,QADI;MAEVU,iBAAiB,EAAE;gDACuB;UACtCC,KAAK,EAAE,CACL;YACEX,IAAI,EAAE,QADR;YAEEG,SAAS,EAAE,IAFb;YAGEE,YAAY,EAAE;cACZL,IAAI,EACF,mEAFU;cAGZG,SAAS,EACP;;WARD,EAWL;YACEH,IAAI,EAAE,SADR;YAEEK,YAAY,EAAE;cACZL,IAAI,EACF;;WAfD,EAkBL;YACEA,IAAI,EAAE,QADR;YAEEK,YAAY,EAAE;cACZL,IAAI,EACF;;WAtBD,CAD+B;UA2BtCK,YAAY,EAAE;YACZM,KAAK,EACH;;;OAhCE;MAoCVC,aAAa,EAAE,GApCL;MAqCVC,oBAAoB,EAAE,KArCZ;MAsCVR,YAAY,EAAE;QACZO,aAAa,EAAE,uDADH;QAEZC,oBAAoB,EAClB;;KAxFI;IA2FVC,KAAK,EAAE;MACLd,IAAI,EAAE,CAAC,QAAD,EAAW,MAAX,CADD;MAELC,UAAU,EAAE;QACVD,IAAI,EAAE;UACJA,IAAI,EAAE,QADF;UAEJE,OAAO,EAAE,qBAFL;UAGJC,SAAS,EAAE,EAHP;UAIJC,SAAS,EAAE,CAJP;UAKJC,YAAY,EAAE;YACZL,IAAI,EACF,uIAFU;YAGZG,SAAS,EACP,gEAJU;YAKZC,SAAS,EACP;;SAZI;QAeVE,OAAO,EAAE;UACPN,IAAI,EAAE,SADC;UAEPe,IAAI,EAAE,CAAC,IAAD,CAFC;UAGPV,YAAY,EAAE;YACZL,IAAI,EAAE,6BADM;YAEZe,IAAI,EAAE;;SApBA;QAuBVR,EAAE,EAAE;UACFP,IAAI,EAAE,CAAC,QAAD,EAAW,SAAX,CADJ;UAEFE,OAAO,EAAE,UAFP;UAGFC,SAAS,EAAE,GAHT;UAIFC,SAAS,EAAE,CAJT;UAKFC,YAAY,EAAE;YACZL,IAAI,EACF,yFAFU;YAGZG,SAAS,EACP,sEAJU;YAKZC,SAAS,EACP;;SAlCI;QAqCVI,WAAW,EAAE;UACXR,IAAI,EAAE,QADK;UAEXG,SAAS,EAAE,GAFA;UAGXC,SAAS,EAAE,CAHA;UAIXC,YAAY,EAAE;YACZL,IAAI,EAAE,0CADM;YAEZG,SAAS,EACP,+EAHU;YAIZC,SAAS,EACP;;SA9CI;QAiDVK,UAAU,EAAE;UACVT,IAAI,EAAE,QADI;UAEVU,iBAAiB,EAAE;oDACuB;cACtCC,KAAK,EAAE,CACL;gBACEX,IAAI,EAAE,QADR;gBAEEG,SAAS,EAAE,IAFb;gBAGEE,YAAY,EAAE;kBACZL,IAAI,EACF,iEAFU;kBAGZG,SAAS,EACP;;eARD,EAWL;gBACEH,IAAI,EAAE,SADR;gBAEEK,YAAY,EAAE;kBACZL,IAAI,EACF;;eAfD,EAkBL;gBACEA,IAAI,EAAE,QADR;gBAEEK,YAAY,EAAE;kBACZL,IAAI,EACF;;eAtBD,CAD+B;cA2BtCK,YAAY,EAAE;gBACZM,KAAK,EACH;;;WAhCE;UAoCVC,aAAa,EAAE,GApCL;UAqCVC,oBAAoB,EAAE,KArCZ;UAsCVR,YAAY,EAAE;YACZQ,oBAAoB,EAClB;;;OA3FH;MA+FLG,QAAQ,EAAE,CAAC,IAAD,CA/FL;MAgGLH,oBAAoB,EAAE,KAhGjB;MAiGLR,YAAY,EAAE;QACZW,QAAQ,EAAE,qCADE;QAEZH,oBAAoB,EAClB;;;GAjMK;EAqMbG,QAAQ,EAAE,CAAC,IAAD,CArMG;EAsMbH,oBAAoB,EAAE,KAtMT;EAuMbR,YAAY,EAAE;IACZL,IAAI,EAAE,6CADM;IAEZgB,QAAQ,EAAE,sCAFE;IAGZH,oBAAoB,EAClB;;CA3MN;AA+MA,MAAMI,GAAG,GAAGC,GAAG,CAAC;EAACC,SAAS,EAAE,IAAZ;EAAkBC,YAAY,EAAE;CAAjC,CAAf;AACAC,SAAS,CAACJ,GAAD,CAAT;AACA,MAAMK,QAAQ,GAAGL,GAAG,CAACM,OAAJ,CAAYxB,MAAZ,CAAjB;AAEA,AAAO,MAAMyB,mBAAmB,GAAG,MAA5B;AAEP,AAAe,MAAMC,aAAN,CAAoB;EACjCC,WAAW,CAACC,GAAD,EAAM;QACXC,OAAO,GAAGH,aAAa,CAACI,aAAd,CAA4BF,GAA5B,CAAd;;QAEI,CAACC,OAAL,EAAc;WACPE,MAAL,GAAc,IAAd;;;;IAIFH,GAAG,GAAGF,aAAa,CAACM,YAAd,CAA2BJ,GAA3B,CAAN;IACAC,OAAO,GAAGH,aAAa,CAACO,aAAd,CAA4BL,GAA5B,CAAV;;QAEI,CAACC,OAAL,EAAc;WACPE,MAAL,GAAc,IAAd;;;;SAIGA,MAAL,GAAcH,GAAd;;;SAGKE,aAAP,CAAqBF,GAArB,EAA0B;QACpBC,OAAO,GAAGN,QAAQ,CAACK,GAAD,CAAtB;;QACI,CAACC,OAAL,EAAc;MACZjC,MAAM,CAAC2B,QAAQ,CAACW,MAAT,CAAgBC,GAAhB,CAAoBC,CAAC,IAAIA,CAAC,CAACC,OAA3B,CAAD,CAAN;;;QAGER,OAAJ,EAAa;YACLtB,OAAO,GAAGqB,GAAG,CAACrB,OAAJ,KAAgB+B,SAAhB,GAA4BV,GAAG,CAACrB,OAAhC,GAA0C,KAA1D;YACMN,IAAI,GAAG2B,GAAG,CAAC3B,IAAJ,KAAaqC,SAAb,GAAyBV,GAAG,CAAC3B,IAA7B,GAAoCwB,mBAAjD;YAEMc,UAAU,GAAGtC,IAAI,CAACuC,WAAL,CAAiB,OAAjB,CAAnB;;UAEED,UAAU,KAAK,CAAC,CAAhB,IACAA,UAAU,KAAKtC,IAAI,CAACwC,MAAL,GAAc,QAAQA,MADrC,IAEA,CAAClC,OAHH,EAIE;QACAX,MAAM,CACJ,+HADI,CAAN;QAGAiC,OAAO,GAAG,KAAV;;;;WAIGA,OAAP;;;SAGKG,YAAP,CAAoBJ,GAApB,EAAyB;UACjBc,KAAK,GAAGC,MAAM,CAACC,MAAP,CAAc,EAAd,EAAkBhB,GAAlB,CAAd;;QAEIA,GAAG,CAAClB,UAAJ,KAAmB4B,SAAvB,EAAkC;MAChCI,KAAK,CAAChC,UAAN,GAAmBiC,MAAM,CAACC,MAAP,CAAc,EAAd,EAAkBhB,GAAG,CAAClB,UAAtB,CAAnB;;;QAGEkB,GAAG,CAACb,KAAJ,KAAcuB,SAAlB,EAA6B;MAC3BI,KAAK,CAAC3B,KAAN,GAAc4B,MAAM,CAACC,MAAP,CAAc,EAAd,EAAkBhB,GAAG,CAACb,KAAtB,CAAd;;UAEIa,GAAG,CAACb,KAAJ,CAAUL,UAAV,KAAyB4B,SAA7B,EAAwC;QACtCI,KAAK,CAAC3B,KAAN,CAAYL,UAAZ,GAAyBiC,MAAM,CAACC,MAAP,CAAc,EAAd,EAAkBhB,GAAG,CAACb,KAAJ,CAAUL,UAA5B,CAAzB;;;;WAIGgC,KAAP;;;SAGKT,aAAP,CAAqBL,GAArB,EAA0B;QACpBA,GAAG,CAAC3B,IAAJ,KAAaqC,SAAjB,EAA4B;MAC1BV,GAAG,CAAC3B,IAAJ,GAAWwB,mBAAX;;;QAGEG,GAAG,CAACnB,WAAJ,KAAoB6B,SAAxB,EAAmC;MACjCV,GAAG,CAACnB,WAAJ,GAAkB,KAAKmB,GAAG,CAACpB,EAA3B;;;QAGEoB,GAAG,CAACrB,OAAJ,KAAgB+B,SAApB,EAA+B;MAC7BV,GAAG,CAACrB,OAAJ,GAAc,KAAd;;;QAGEsC,MAAM,CAACC,SAAP,CAAiBlB,GAAG,CAACpB,EAArB,CAAJ,EAA8B;YACtBuC,KAAK,GAAG,KAAKnB,GAAG,CAACpB,EAAvB;;UACIuC,KAAK,CAACN,MAAN,GAAe,GAAnB,EAAwB;QACtB7C,MAAM,CAAC,yCAAD,CAAN;eACO,KAAP;;;MAEFgC,GAAG,CAACpB,EAAJ,GAASuC,KAAT;;;QAGEhC,KAAK,GAAG,IAAZ;;QACIa,GAAG,CAACb,KAAJ,KAAcuB,SAAlB,EAA6B;MAC3BvB,KAAK,GAAGa,GAAG,CAACb,KAAZ;;;QAGEA,KAAK,KAAK,IAAV,IAAkBA,KAAK,CAACN,WAAN,KAAsB6B,SAA5C,EAAuD;MACrDvB,KAAK,CAACN,WAAN,GAAoB,KAAKM,KAAK,CAACP,EAA/B;;;QAGEO,KAAK,KAAK,IAAV,IAAkBA,KAAK,CAACd,IAAN,KAAeqC,SAArC,EAAgD;MAC9CvB,KAAK,CAACd,IAAN,GAAa2B,GAAG,CAAC3B,IAAJ,GAAW,OAAxB;;;QAGEc,KAAK,KAAK,IAAd,EAAoB;MAClBA,KAAK,CAACR,OAAN,GAAgB,IAAhB;;;QAGEQ,KAAK,KAAK,IAAd,EAAoB;UACd8B,MAAM,CAACC,SAAP,CAAiB/B,KAAK,CAACP,EAAvB,CAAJ,EAAgC;cACxBuC,KAAK,GAAG,KAAKhC,KAAK,CAACP,EAAzB;;YACIuC,KAAK,CAACN,MAAN,GAAe,GAAnB,EAAwB;UACtB7C,MAAM,CAAC,yCAAD,CAAN;iBACO,KAAP;;;QAEFmB,KAAK,CAACP,EAAN,GAAWuC,KAAX;;;;WAIG,IAAP;;;EAGFC,OAAO,GAAG;WACDC,GAAG,CACRC,SAAS,mBACJ,KAAKnB,MADD;MAEPrB,UAAU,EAAE,KAAKqB,MAAL,CAAYrB,UAAZ,IAA0B,EAF/B;MAGPK,KAAK,oBACA,KAAKgB,MAAL,CAAYhB,KADZ;QAEHL,UAAU,EAAG,KAAKqB,MAAL,CAAYhB,KAAZ,IAAqB,KAAKgB,MAAL,CAAYhB,KAAZ,CAAkBL,UAAxC,IAAuD;;OAN/D,CAAV;;;EAYFyC,KAAK,GAAG;UACAvB,GAAG,GAAG,KAAKG,MAAjB;WACQ,GAAEH,GAAG,CAAC3B,IAAK,IAAG2B,GAAG,CAACpB,EAAG,EAA7B;;;EAGFqB,OAAO,GAAG;WACD,KAAKE,MAAL,KAAgB,IAAvB;;;EAGFqB,YAAY,GAAG;WACN,KAAKrB,MAAZ;;;EAGFsB,SAAS,GAAG;UACJzB,GAAG,GAAG,KAAKG,MAAjB;UACMW,KAAK,GAAGC,MAAM,CAACC,MAAP,CAAc,EAAd,EAAkBhB,GAAlB,CAAd;WACOc,KAAK,CAAC3B,KAAb;WACO,IAAIW,aAAJ,CAAkBgB,KAAlB,CAAP;;;EAGFY,QAAQ,GAAG;UACHvC,KAAK,GAAG,KAAKgB,MAAL,CAAYhB,KAAZ,IAAqB,IAAnC;WACOA,KAAK,IAAI,IAAIW,aAAJ,CAAkBX,KAAlB,CAAhB;;;;;AChXG,MAAMwC,gBAAgB,GAAG,QAAzB;AACP,AAAO,MAAMC,aAAa,GAAG,KAAtB;AACP,AAAO,MAAMC,eAAe,GAAG,OAAxB;AACP,AAAO,MAAMC,iBAAiB,GAAG,SAA1B;AACP,AAAO,MAAMC,cAAc,GAAG,MAAvB;AACP,AAAO,MAAMC,kBAAkB,GAAG,UAA3B;AAEP,AAAO,MAAMC,gBAAgB,GAAG,IAAzB;AACP,AAAO,MAAMC,oBAAoB,GAAG,QAA7B;AACP,AAAO,MAAMC,gBAAgB,GAAG,IAAzB;AACP,AAAO,MAAMC,oBAAoB,GAAG,QAA7B;AACP,AAAO,MAAMC,gBAAgB,GAAG,IAAzB;AACP,AAAO,MAAMC,iBAAiB,GAAG,KAA1B;AACP,AAAO,MAAMC,gBAAgB,GAAG,IAAzB;AACP,AAAO,MAAMC,iBAAiB,GAAG,KAA1B;AACP,AAAO,MAAMC,kBAAkB,GAAG,MAA3B;AACP,AAAO,MAAMC,mBAAmB,GAAG,OAA5B;AACP,AAAO,MAAMC,mBAAmB,GAAG,OAA5B;AACP,AAAO,MAAMC,oBAAoB,GAAG,QAA7B;AAEP,AAAO,MAAMC,cAAc,GAAGC,CAAC,IAAI;SACzBC,QAAQ,CAAC1B,GAAG,CAACyB,CAAD,CAAJ,EAAS,EAAT,CAAR,GAAuB,GAAxB,GAA+B,uCAAtC;CADK;AAIP,AAAe,MAAME,UAAN,CAAiB;EAC9BjD,WAAW,CAACkD,UAAD,EAAa;SACjBA,UAAL,GAAkBA,UAAlB;;;SAGKC,mBAAP,CAA2BC,CAA3B,EAA8B;QACxBA,CAAC,KAAK,IAAN,IAAcA,CAAC,KAAK,KAAxB,EAA+B;aACtB,SAAP;KADF,MAEO,IAAI,OAAOA,CAAP,KAAa,QAAjB,EAA2B;UAC5B,CAACA,CAAC,GAAG,EAAL,EAASC,OAAT,CAAiB,GAAjB,KAAyB,CAA7B,EAAgC;eACvB,OAAP;OADF,MAEO;eACE,KAAP;;KAJG,MAMA,IAAI,OAAOD,CAAP,KAAa,QAAjB,EAA2B;YAC1BE,aAAa,GAAG,IAAIC,IAAJ,CAASH,CAAT,EAAYI,OAAZ,EAAtB;;UAEI,CAACC,KAAK,CAACH,aAAD,CAAV,EAA2B;cACnBI,SAAS,GAAG,IAAIH,IAAJ,CAASH,CAAT,EAAYO,WAAZ,EAAlB;cACMC,SAAS,GAAGF,SAAS,CAAC7C,WAAV,CAAsB,gBAAtB,CAAlB;;YAEE+C,SAAS,KAAK,CAAC,CAAf,IACAF,SAAS,CAAC5C,MAAV,GAAmB,iBAAiBA,MAApC,KAA+C8C,SAFjD,EAGE;iBACO,MAAP;SAJF,MAKO;iBACE,UAAP;;;;aAIG,QAAP;;;IAEF3F,MAAM,CAAC,6CAAD,CAAN;WACO,IAAP;;;EAGF4F,YAAY,CAACC,IAAD,EAAO7D,GAAP,EAAY;UAChBlB,UAAU,GAAGkB,GAAG,CAAClB,UAAJ,IAAkB,EAArC;;QAEI,CAACA,UAAU,CAACgF,cAAX,CAA0BD,IAAI,CAACE,aAA/B,CAAL,EAAoD;aAC3C,KAAP;;;UAGIZ,CAAC,GAAGrE,UAAU,CAAC+E,IAAI,CAACE,aAAN,CAApB;UACMC,aAAa,GAAGhB,UAAU,CAACE,mBAAX,CAA+BC,CAA/B,CAAtB;UAEMc,WAAW,GAAG,CAACrC,aAAD,EAAgBC,eAAhB,CAApB;;QAGEoC,WAAW,CAACb,OAAZ,CAAoBY,aAApB,MAAuC,CAAC,CAAxC,IACAC,WAAW,CAACb,OAAZ,CAAoBS,IAAI,CAACG,aAAzB,MAA4C,CAAC,CAF/C,EAGE,CAHF,MAKO,IAAIA,aAAa,KAAKH,IAAI,CAACG,aAA3B,EAA0C;aACxC,KAAP;;;UAGIE,SAAS,GAAGL,IAAI,CAACM,KAAvB;UACMC,aAAa,GAAGP,IAAI,CAACQ,SAA3B;UACMC,EAAE,GAAGT,IAAI,CAACU,QAAhB;;QAEIP,aAAa,KAAKrC,gBAAtB,EAAwC;UAClC2C,EAAE,KAAKrC,gBAAX,EAA6B;eACpBkB,CAAC,KAAKe,SAAb;OADF,MAEO,IAAII,EAAE,KAAKpC,oBAAX,EAAiC;eAC/BiB,CAAC,KAAKe,SAAb;OADK,MAEA,IAAII,EAAE,KAAKnC,gBAAX,EAA6B;eAC3BiC,aAAa,CAAChB,OAAd,CAAsBD,CAAtB,MAA6B,CAAC,CAArC;OADK,MAEA,IAAImB,EAAE,KAAKlC,oBAAX,EAAiC;eAC/BgC,aAAa,CAAChB,OAAd,CAAsBD,CAAtB,MAA6B,CAAC,CAArC;OADK,MAEA;QACLnF,MAAM,CAAC,mCAAD,CAAN;eACO,KAAP;;KAXJ,MAaO,IAAIiG,WAAW,CAACb,OAAZ,CAAoBY,aAApB,MAAuC,CAAC,CAA5C,EAA+C;UAChDM,EAAE,KAAKrC,gBAAX,EAA6B;eACpBkB,CAAC,KAAKe,SAAb;OADF,MAEO,IAAII,EAAE,KAAKpC,oBAAX,EAAiC;eAC/BiB,CAAC,KAAKe,SAAb;OADK,MAEA,IAAII,EAAE,KAAKnC,gBAAX,EAA6B;eAC3BiC,aAAa,CAAChB,OAAd,CAAsBD,CAAtB,MAA6B,CAAC,CAArC;OADK,MAEA,IAAImB,EAAE,KAAKlC,oBAAX,EAAiC;eAC/BgC,aAAa,CAAChB,OAAd,CAAsBD,CAAtB,MAA6B,CAAC,CAArC;OADK,MAEA,IAAImB,EAAE,KAAKjC,gBAAX,EAA6B;eAC3Bc,CAAC,GAAGe,SAAX;OADK,MAEA,IAAII,EAAE,KAAKhC,iBAAX,EAA8B;eAC5Ba,CAAC,IAAIe,SAAZ;OADK,MAEA,IAAII,EAAE,KAAK/B,gBAAX,EAA6B;eAC3BY,CAAC,GAAGe,SAAX;OADK,MAEA,IAAII,EAAE,KAAK9B,iBAAX,EAA8B;eAC5BW,CAAC,IAAIe,SAAZ;OADK,MAEA;QACLlG,MAAM,CAAC,mCAAD,CAAN;eACO,KAAP;;KAnBG,MAqBA,IAAIgG,aAAa,KAAKlC,iBAAtB,EAAyC;UAC1CwC,EAAE,KAAKrC,gBAAX,EAA6B;eACpBkB,CAAC,KAAKe,SAAb;OADF,MAEO,IAAII,EAAE,KAAKpC,oBAAX,EAAiC;eAC/BiB,CAAC,KAAKe,SAAb;OADK,MAEA;QACLlG,MAAM,CAAC,mCAAD,CAAN;eACO,KAAP;;KAPG,MASA,IACLgG,aAAa,KAAKjC,cAAlB,IACAiC,aAAa,KAAKhC,kBAFb,EAGL;YACMwC,UAAU,GAAGN,SAAS,IAAI,IAAIZ,IAAJ,CAASY,SAAT,EAAoBX,OAApB,EAAhC;YACMkB,cAAc,GAClBL,aAAa,IAAIA,aAAa,CAAC7D,GAAd,CAAkBmE,EAAE,IAAI,IAAIpB,IAAJ,CAASoB,EAAT,EAAanB,OAAb,EAAxB,CADnB;YAEMoB,KAAK,GAAG,IAAIrB,IAAJ,CAASH,CAAT,EAAYI,OAAZ,EAAd;;UAEIe,EAAE,KAAKrC,gBAAX,EAA6B;eACpB0C,KAAK,KAAKH,UAAjB;OADF,MAEO,IAAIF,EAAE,KAAKpC,oBAAX,EAAiC;eAC/ByC,KAAK,KAAKH,UAAjB;OADK,MAEA,IAAIF,EAAE,KAAKnC,gBAAX,EAA6B;eAC3BsC,cAAc,CAACrB,OAAf,CAAuBuB,KAAvB,MAAkC,CAAC,CAA1C;OADK,MAEA,IAAIL,EAAE,KAAKlC,oBAAX,EAAiC;eAC/BqC,cAAc,CAACrB,OAAf,CAAuBuB,KAAvB,MAAkC,CAAC,CAA1C;OADK,MAEA,IAAIL,EAAE,KAAK7B,kBAAX,EAA+B;eAC7BkC,KAAK,IAAIH,UAAhB;OADK,MAEA,IAAIF,EAAE,KAAK5B,mBAAX,EAAgC;eAC9BiC,KAAK,IAAIH,UAAhB;OADK,MAEA,IAAIF,EAAE,KAAK3B,mBAAX,EAAgC;eAC9BgC,KAAK,GAAGH,UAAf;OADK,MAEA,IAAIF,EAAE,KAAK1B,oBAAX,EAAiC;eAC/B+B,KAAK,GAAGH,UAAf;OADK,MAEA;QACLxG,MAAM,CAAC,mCAAD,CAAN;eACO,KAAP;;KA3BG,MA6BA;MACLA,MAAM,CAAC,oCAAD,CAAN;aACO,KAAP;;;;EAIJ4G,aAAa,CAAC5E,GAAD,EAAM6E,GAAN,EAAWC,IAAX,EAAiBC,MAAjB,EAAyB;UAC9B9B,UAAU,GAAG,KAAKA,UAAxB;;QACI,KAAKA,UAAL,CAAgB+B,UAAhB,KAA+BhF,GAAG,CAAC3B,IAAvC,EAA6C;aACpC;QAAC4G,QAAQ,EAAE;OAAlB;;;UAGIC,MAAM,GAAGH,MAAM,GACjB,KAAK9B,UAAL,CAAgBkC,SAAhB,CACEC,IAAI,CAACC,KAAL,CAAWtC,QAAQ,CAAC,KAAKE,UAAL,CAAgBqC,UAAhB,GAA6B,GAA9B,CAAnB,IAAyD,CAD3D,CADiB,GAIjBR,IAAI,CAACI,MAJT;UAKMK,SAAS,GAAG,EAAlB;;SACK,IAAIC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGN,MAAM,CAACrE,MAA3B,EAAmC2E,CAAC,EAApC,EAAwC;YAChCC,KAAK,GAAGP,MAAM,CAACM,CAAD,CAApB;MACAD,SAAS,CAACE,KAAK,CAACC,WAAP,CAAT,GAA+BD,KAA/B;;;UAGIE,KAAK,GAAG1C,UAAU,CAAC0C,KAAzB;QAEIC,OAAO,GAAG,IAAd;;SAEK,IAAIJ,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGG,KAAK,CAAC9E,MAA1B,EAAkC2E,CAAC,EAAnC,EAAuC;YAC/BK,CAAC,GAAGF,KAAK,CAACH,CAAD,CAAf;MACAI,OAAO,GAAGA,OAAO,IAAI,KAAKhC,YAAL,CAAkBiC,CAAlB,EAAqB7F,GAArB,CAArB;;;QAGE4F,OAAJ,EAAa;YACLE,eAAe,GAAI,oBAAmBhB,IAAI,CAACiB,OAAQ,QACvDlB,GAAG,CAACkB,OACL,aAAY,KAAK9C,UAAL,CAAgB8C,OAAQ,kBAAiB/F,GAAG,CAAC3B,IAAK,IAAG2B,GAAG,CAACpB,EAAG,EAFzE;;UAIIiE,cAAc,CAACiD,eAAD,CAAd,IAAmC,KAAK7C,UAAL,CAAgBqC,UAAvD,EAAmE;YAC7D,KAAKrC,UAAL,CAAgBqC,UAAhB,KAA+B,CAAnC,EAAsC;iBAC7B;YAACL,QAAQ,EAAE;WAAlB;;;cAGIe,iBAAiB,GAAI,wBAAuBlB,IAAI,CAACiB,OAAQ,QAC7DlB,GAAG,CAACkB,OACL,kBAAiB/F,GAAG,CAAC3B,IAAK,IAAG2B,GAAG,CAACpB,EAAG,EAFrC;cAIMqH,0BAA0B,GAAGpD,cAAc,CAACmD,iBAAD,CAAjD;YAEIE,WAAW,GAAG,GAAlB;cAEMC,UAAU,GAAGrB,IAAI,CAACqB,UAAL,CAAgBC,MAAhB,CAAuBC,CAAC,IAAI,CAACA,CAAC,CAACC,cAA/B,CAAnB;YAEIC,SAAS,GAAG,IAAhB;;aACK,IAAIf,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGW,UAAU,CAACtF,MAA/B,EAAuC2E,CAAC,EAAxC,EAA4C;gBACpCa,CAAC,GAAGF,UAAU,CAACX,CAAD,CAApB;;cACID,SAAS,CAACzB,cAAV,CAAyBuC,CAAC,CAACX,WAA3B,CAAJ,EAA6C;YAC3CQ,WAAW,GAAGM,UAAU,CACtB,CAACN,WAAW,GAAGX,SAAS,CAACc,CAAC,CAACX,WAAH,CAAT,CAAyBJ,UAAxC,EAAoDmB,OAApD,CAA4D,CAA5D,CADsB,CAAxB;;gBAIIR,0BAA0B,IAAIC,WAAlC,EAA+C;cAC7CK,SAAS,GAAGF,CAAZ;;;;;;eAMC;UAACE,SAAS,EAAEA,SAAZ;UAAuBtB,QAAQ,EAAE;SAAxC;OA9BF,MA+BO;eACE;UAACA,QAAQ,EAAE;SAAlB;;KArCJ,MAuCO;aACE;QAACA,QAAQ,EAAE;OAAlB;;;;;;ACxON,MAAMyB,UAAU,GAAG,GAAnB;AAEA,AAAe,MAAMC,IAAN,CAAW;SACjBC,YAAP,CAAoBC,KAApB,EAA2B;UACnBC,MAAM,GAAGD,KAAK,CAACE,MAAN,CAAa,CAACD,MAAD,EAASE,IAAT,KAAkB;YACtCC,GAAG,GAAG,CAACD,IAAI,CAACE,IAAN,EAAYF,IAAI,CAAC3I,IAAjB,EAAuB8I,IAAvB,CAA4B,GAA5B,CAAZ;MACAL,MAAM,CAACG,GAAD,CAAN,GAAcH,MAAM,CAACG,GAAD,CAAN,IAAe,EAA7B;MACAH,MAAM,CAACG,GAAD,CAAN,CAAYG,IAAZ,CAAiBJ,IAAjB;aACOF,MAAP;KAJa,EAKZ,EALY,CAAf;WAOO/F,MAAM,CAACsG,MAAP,CAAcP,MAAd,EAAsBvG,GAAtB,CAA0BsG,KAAK,IAAI;YAClCS,OAAO,GAAG,IAAIX,IAAJ,CAASE,KAAK,CAAC,CAAD,CAAL,CAASK,IAAlB,EAAwBL,KAAK,CAAC,CAAD,CAAL,CAASxI,IAAjC,CAAhB;;cACQiJ,OAAO,CAACjJ,IAAhB;aACOsI,IAAI,CAACY,aAAV;gBACQC,aAAa,GAAGX,KAAK,CAACE,MAAN,CACpB,CAACU,QAAD,EAAWT,IAAX,KAAoBS,QAAQ,GAAGT,IAAI,CAACU,eAAL,GAAuBV,IAAI,CAACW,KADvC,EAEpB,CAFoB,CAAtB;gBAIMC,UAAU,GAAGf,KAAK,CAACE,MAAN,CACjB,CAACY,KAAD,EAAQX,IAAR,KAAiBW,KAAK,GAAGX,IAAI,CAACW,KADb,EAEjB,CAFiB,CAAnB;UAIAL,OAAO,CAACO,kBAAR,CAA2BL,aAAa,GAAGI,UAA3C;UACAN,OAAO,CAACQ,QAAR,CAAiBF,UAAjB;;;aAEGjB,IAAI,CAACoB,UAAV;UACET,OAAO,CAACQ,QAAR,CAAiBjB,KAAK,CAACE,MAAN,CAAa,CAACY,KAAD,EAAQX,IAAR,KAAiBW,KAAK,GAAGX,IAAI,CAACW,KAA3C,EAAkD,CAAlD,CAAjB;;;;aAGGL,OAAP;KAnBK,CAAP;;;EAuBFvH,WAAW,CAACmH,IAAD,EAAO7I,IAAP,EAAa;UAChB2J,YAAY,GAAG,CAACrB,IAAI,CAACY,aAAN,EAAqBZ,IAAI,CAACoB,UAA1B,CAArB;;QACIC,YAAY,CAAC5E,OAAb,CAAqB/E,IAArB,MAA+B,CAAC,CAApC,EAAuC;YAC/B,0BAAN;;;SAEG6I,IAAL,GAAYA,IAAZ;SACK7I,IAAL,GAAYA,IAAZ;SAEKsJ,KAAL,GAAa,CAAb;SACKM,SAAL,GAAiB,IAAjB;SAEKP,eAAL,GAAuB,CAAvB;;;EAGFQ,KAAK,GAAG;QACF,KAAKR,eAAL,KAAyB,CAA7B,EAAgC;YACxB,6BAAN;;;QAGE,KAAKO,SAAL,KAAmB,IAAvB,EAA6B;YACrB,6BAAN;;;SAGGA,SAAL,GAAiBE,OAAO,CAACC,MAAR,EAAjB;WACO,IAAP;;;EAGFC,IAAI,GAAG;QACD,KAAKX,eAAL,KAAyB,CAA7B,EAAgC;YACxB,6BAAN;;;QAGE,KAAKO,SAAL,KAAmB,IAAvB,EAA6B;YACrB,kCAAN;;;UAGIK,QAAQ,GAAGH,OAAO,CAACC,MAAR,CAAe,KAAKH,SAApB,CAAjB;SACKP,eAAL,GAAuBY,QAAQ,CAAC,CAAD,CAAR,GAAc5B,UAAd,GAA2B4B,QAAQ,CAAC,CAAD,CAA1D;SACKX,KAAL,GAAa,CAAb;WACO,IAAP;;;EAGFG,QAAQ,CAACS,CAAD,EAAI;SACLZ,KAAL,GAAaY,CAAb;WACO,IAAP;;;EAGFV,kBAAkB,CAACxB,CAAD,EAAI;SACfqB,eAAL,GAAuBrB,CAAvB;WACO,IAAP;;;EAGFmC,WAAW,GAAG;WACL,KAAKd,eAAZ;;;EAGFe,WAAW,GAAG;UACNC,QAAQ,GAAG;MACfxB,IAAI,EAAE,KAAKA;KADb;;QAGI,KAAK7I,IAAL,KAAcsI,IAAI,CAACY,aAAvB,EAAsC;UAChC,KAAKG,eAAL,KAAyB,CAA7B,EAAgC;QAC9BgB,QAAQ,CAACjB,QAAT,GAAoB,KAAKC,eAAzB;QACAgB,QAAQ,CAACC,IAAT,GAAgB,IAAhB;QACAD,QAAQ,CAACf,KAAT,GAAiB,KAAKA,KAAtB;eACOe,QAAP;;KALJ,MAOO,IAAI,KAAKrK,IAAL,KAAcsI,IAAI,CAACoB,UAAvB,EAAmC;MACxCW,QAAQ,CAACf,KAAT,GAAiB,KAAKA,KAAtB;aACOe,QAAP;;;WAEK,IAAP;;;;AAIJ/B,IAAI,CAACY,aAAL,GAAqB,qBAArB;AACAZ,IAAI,CAACoB,UAAL,GAAkB,kBAAlB;;ACzGe,MAAMa,WAAN,CAAkB;EAC/BC,QAAQ,CAAC7I,GAAD,EAAM;SACPG,MAAL,GAAcH,GAAd;;;QAGI8I,WAAN,GAAoB;;EAEpBC,eAAe,CAAC/I,GAAD,EAAM;UACbgJ,UAAU,GACdhJ,GAAG,YAAYF,aAAf,GAA+BE,GAA/B,GAAqC,IAAIF,aAAJ,CAAkBE,GAAlB,CADvC;WAGOgJ,UAAP;;;EAGFC,SAAS,GAAG;;EAEZC,aAAa,GAAG;;QAEVC,OAAN,CAAcC,IAAd,EAAoB;;EAEpBC,QAAQ,GAAG;;EAEXvE,IAAI,CAACwE,QAAD,EAAW;UACPxE,IAAI,GAAG,KAAKyE,MAAL,CAAYC,OAAZ,CAAoBF,QAApB,CAAb;IACAxE,IAAI,CAAC2E,WAAL,CAAiB,IAAjB;WACO3E,IAAP;;;EAGF4E,cAAc,CAAC5E,IAAD,EAAOkE,UAAP,EAAmB;UACzBW,YAAY,GAAG7E,IAAI,CAAC6E,YAA1B;;QAEI7E,IAAI,CAAC8E,UAAL,EAAJ,EAAuB;MACrB5L,MAAM,CAAE,aAAY8G,IAAI,CAAC+E,QAAS,qBAA5B,CAAN;aACO;QACLtD,SAAS,EAAEoD,YADN;QAEL1E,QAAQ,EAAE;OAFZ;;;QAMEH,IAAI,CAACgF,QAAT,EAAmB;aACV;QACLvD,SAAS,EAAEoD,YADN;QAEL1E,QAAQ,EAAE;OAFZ;KAZ6B;;;;QAoB3B,CAAC+D,UAAL,EAAiB;aACR;QACLzC,SAAS,EAAEoD,YADN;QAEL1E,QAAQ,EAAE;OAFZ;;;UAMIrG,EAAE,GAAGoK,UAAU,CAACzH,KAAX,EAAX;UACMwI,QAAQ,GAAGjF,IAAI,CAACkF,SAAL,CAAepL,EAAf,CAAjB;;QAEImL,QAAJ,EAAc;YACNxD,SAAS,GAAGzB,IAAI,CAACmF,aAAL,CAAmBF,QAAQ,CAACrE,WAA5B,CAAlB;aACO;QACLa,SAAS,EAAEA,SADN;QAELtB,QAAQ,EAAE,CAACsB,SAAS,CAACD,cAFhB;QAGL4D,YAAY,EAAE;OAHhB;;;UAOIlK,GAAG,GAAGgJ,UAAU,CAACxH,YAAX,EAAZ;UACM2I,YAAY,GAAGrF,IAAI,CAACsF,OAAL,OAAmB,YAAxC;UACMC,WAAW,GAAGvF,IAAI,CAACuF,WAAzB;QACI9D,SAAS,GAAG,IAAhB;QACItB,QAAQ,GAAG,KAAf;;SAEK,IAAIO,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG6E,WAAW,CAACxJ,MAAhC,EAAwC2E,CAAC,EAAzC,EAA6C;YACrC8E,CAAC,GAAG,IAAItH,UAAJ,CAAeqH,WAAW,CAAC7E,CAAD,CAA1B,CAAV;YACM+E,UAAU,GAAGD,CAAC,CAAC1F,aAAF,CACjB5E,GADiB,EAEjB,KAAKuJ,MAAL,CAAYiB,MAAZ,EAFiB,EAGjB1F,IAHiB,EAIjBqF,YAJiB,CAAnB;MAMAlF,QAAQ,GAAGA,QAAQ,IAAIsF,UAAU,CAACtF,QAAlC;;UACIsF,UAAU,CAAChE,SAAf,EAA0B;QACxBA,SAAS,GAAGgE,UAAU,CAAChE,SAAvB;;;;;WAKG;MACLA,SAAS,EAAEA,SAAS,IAAIoD,YADnB;MAEL1E,QAAQ,EAAEA;KAFZ;;;EAMFwF,mBAAmB,CAACC,MAAD,EAASC,MAAT,EAAiB;QAC9BD,MAAM,CAACR,YAAX,EAAyB;aAChBQ,MAAP;;;QAGEC,MAAM,CAACT,YAAX,EAAyB;aAChBS,MAAP;;;QAGE,CAACD,MAAM,CAACnE,SAAP,CAAiBD,cAAtB,EAAsC;aAC7BoE,MAAP;;;QAGE,CAACC,MAAM,CAACpE,SAAP,CAAiBD,cAAtB,EAAsC;aAC7BqE,MAAP;;;WAGKD,MAAP;;;EAGFE,YAAY,CAAC5B,UAAD,EAAa6B,KAAb,EAAoB;UACxB7K,GAAG,GAAGgJ,UAAU,CAACxH,YAAX,EAAZ;WACO;MACLnD,IAAI,EAAE2B,GAAG,CAAC3B,IADL;MAELO,EAAE,EAAEoB,GAAG,CAACpB,EAFH;MAGL8G,WAAW,EAAEmF,KAAK,CAACtE,SAAN,CAAgBb,WAHxB;MAILa,SAAS,EAAEsE,KAAK,CAACtE,SAAN,CAAgBsD;KAJ7B;;;EAQFiB,YAAY,CAAChG,IAAD,EAAO9E,GAAP,EAAY;UAChBgH,IAAI,GAAG,IAAIL,IAAJ,CAAS,yBAAT,EAAoCA,IAAI,CAACY,aAAzC,CAAb;IACAP,IAAI,CAACkB,KAAL;IACAlI,GAAG,GAAGA,GAAG,IAAI,KAAKG,MAAlB;;UAEM6I,UAAU,GAAG,KAAKD,eAAL,CAAqB/I,GAArB,CAAnB;;QACI,CAACgJ,UAAU,CAAC/I,OAAX,EAAD,IAAyB6E,IAAI,CAACiG,eAAL,EAA7B,EAAqD;aAC5C,KAAP;;;UAGIC,UAAU,GAAG,KAAKtB,cAAL,CAAoB5E,IAApB,EAA0BkE,UAA1B,CAAnB;;UACMiC,eAAe,GAAG,KAAKvB,cAAL,CAAoB5E,IAApB,EAA0BkE,UAAU,CAACtH,QAAX,EAA1B,CAAxB;;UAEMwJ,eAAe,GAAG,KAAKT,mBAAL,CACtBO,UADsB,EAEtBC,eAFsB,CAAxB;;UAKME,IAAI,GAAG,KAAKP,YAAL,CAAkB5B,UAAlB,EAA8BkC,eAA9B,CAAb;;SACKhC,aAAL,CAAmBiC,IAAnB;;IAEAnE,IAAI,CAACqB,IAAL;;SACKY,SAAL,CAAejC,IAAf;;WACOkE,eAAe,CAAC3E,SAAhB,CAA0BsD,QAAjC;;;EAGFuB,UAAU,CAACtG,IAAD,EAAO9E,GAAP,EAAY;UACdgH,IAAI,GAAG,IAAIL,IAAJ,CAAS,uBAAT,EAAkCA,IAAI,CAACY,aAAvC,CAAb;IACAP,IAAI,CAACkB,KAAL;IACAlI,GAAG,GAAGA,GAAG,IAAI,KAAKG,MAAlB;;UACM6I,UAAU,GAAG,KAAKD,eAAL,CAAqB/I,GAArB,CAAnB;;QACI,CAACgJ,UAAU,CAAC/I,OAAX,EAAD,IAAyB6E,IAAI,CAACiG,eAAL,EAA7B,EAAqD;aAC5C,IAAP;;;UAGIC,UAAU,GAAG,KAAKtB,cAAL,CAAoB5E,IAApB,EAA0BkE,UAA1B,CAAnB;;UACMiC,eAAe,GAAG,KAAKvB,cAAL,CAAoB5E,IAApB,EAA0BkE,UAAU,CAACtH,QAAX,EAA1B,CAAxB;;UAEMwJ,eAAe,GAAG,KAAKT,mBAAL,CACtBO,UADsB,EAEtBC,eAFsB,CAAxB;;IAKAjE,IAAI,CAACqB,IAAL;;SACKY,SAAL,CAAejC,IAAf;;WACOkE,eAAe,CAAC3E,SAAhB,CAA0B8E,OAAjC;;;EAGFC,UAAU,CAACxG,IAAD,EAAO9E,GAAP,EAAY;UACdgH,IAAI,GAAG,IAAIL,IAAJ,CAAS,uBAAT,EAAkCA,IAAI,CAACY,aAAvC,CAAb;IACAP,IAAI,CAACkB,KAAL;IACAlI,GAAG,GAAGA,GAAG,IAAI,KAAKG,MAAlB;;UAEM6I,UAAU,GAAG,KAAKD,eAAL,CAAqB/I,GAArB,CAAnB;;QACI,CAACgJ,UAAU,CAAC/I,OAAX,EAAD,IAAyB6E,IAAI,CAACiG,eAAL,EAA7B,EAAqD;aAC5C,KAAP;;;UAGIC,UAAU,GAAG,KAAKtB,cAAL,CAAoB5E,IAApB,EAA0BkE,UAA1B,CAAnB;;UACMiC,eAAe,GAAG,KAAKvB,cAAL,CAAoB5E,IAApB,EAA0BkE,UAAU,CAACtH,QAAX,EAA1B,CAAxB;;UAEMwJ,eAAe,GAAG,KAAKT,mBAAL,CACtBO,UADsB,EAEtBC,eAFsB,CAAxB;;IAKAjE,IAAI,CAACqB,IAAL;;SACKY,SAAL,CAAejC,IAAf;;WACOkE,eAAe,CAACjG,QAAvB;;;EAGFsG,SAAS,CAACzG,IAAD,EAAO9E,GAAP,EAAY;UACbgH,IAAI,GAAG,IAAIL,IAAJ,CAAS,sBAAT,EAAiCA,IAAI,CAACY,aAAtC,CAAb;IACAP,IAAI,CAACkB,KAAL;IACAlI,GAAG,GAAGA,GAAG,IAAI,KAAKG,MAAlB;;UAEM6I,UAAU,GAAG,KAAKD,eAAL,CAAqB/I,GAArB,CAAnB;;QACI,CAACgJ,UAAU,CAAC/I,OAAX,EAAD,IAAyB6E,IAAI,CAACiG,eAAL,EAA7B,EAAqD;aAC5C,KAAP;;;UAGIC,UAAU,GAAG,KAAKtB,cAAL,CAAoB5E,IAApB,EAA0BkE,UAA1B,CAAnB;;UACMiC,eAAe,GAAG,KAAKvB,cAAL,CAAoB5E,IAApB,EAA0BkE,UAAU,CAACtH,QAAX,EAA1B,CAAxB;;UAEMwJ,eAAe,GAAG,KAAKT,mBAAL,CACtBO,UADsB,EAEtBC,eAFsB,CAAxB;;IAKAjE,IAAI,CAACqB,IAAL;;SACKY,SAAL,CAAejC,IAAf;;WACO,CAACkE,eAAe,CAAC3E,SAAhB,CAA0BD,cAAlC;;;;;AC5NJ;;ACEe,MAAMkF,IAAN,CAAW;EACxBzL,WAAW,CAAC+E,IAAD,EAAO2G,QAAP,EAAiB;QACtB,OAAO3G,IAAP,KAAgB,QAApB,EAA8B;WACvB4G,OAAL,GAAe,IAAf;WACKpC,QAAL,GAAgBxE,IAAhB;KAFF,MAGO;;;WAGAiB,OAAL,GAAejB,IAAI,CAACiB,OAApB;WACKjB,IAAL,GAAYA,IAAZ;WACK+E,QAAL,GAAgB/E,IAAI,CAAC+E,QAArB,CALK;;WAQAC,QAAL,GAAgBhF,IAAI,CAACgF,QAArB;WACKH,YAAL,GAAoB7E,IAAI,CAAC6E,YAAzB;WACKxD,UAAL,GAAkBrB,IAAI,CAACqB,UAAvB;WACK8D,aAAL,GAAqBnF,IAAI,CAACmF,aAA1B;WACKD,SAAL,GAAiBlF,IAAI,CAACkF,SAAtB;WACKK,WAAL,GAAmBvF,IAAI,CAACuF,WAAxB;WACKnF,MAAL,GAAcJ,IAAI,CAACI,MAAnB;;;SAEGuG,QAAL,GAAgBA,QAAhB;;;EAGFV,eAAe,GAAG;WACTY,OAAO,CAAC,KAAKD,OAAN,CAAP,IAAyB,KAAK5G,IAAL,CAAU8G,QAAV,KAAuB,eAAvD;;;EAGFC,MAAM,GAAG;WACAF,OAAO,CAAC,KAAKD,OAAN,CAAd;;;EAGF9B,UAAU,GAAG;WACJ,KAAK9E,IAAL,CAAUgH,UAAV,KAAyB,UAAhC;;;EAGFrC,WAAW,CAACgC,QAAD,EAAW;SACfA,QAAL,GAAgBA,QAAhB;;;EAGFrB,OAAO,GAAG;QACJ,KAAKsB,OAAT,EAAkB;MAChB1N,MAAM,CACH,mCACC,KAAKsL,QACN,uDAHG,CAAN;aAKO,eAAP;;;UAGIsC,QAAQ,GAAG,KAAK9G,IAAL,CAAU8G,QAA3B;;YAEQA,QAAR;WACO,OAAL;eACS,OAAP;;WACG,YAAL;eACS,YAAP;;WACG,eAAL;eACS,eAAP;;;QAEA5N,MAAM,CAAC,kCAAD,CAAN;eACO,IAAP;;;;EAIN8M,YAAY,CAAC9K,GAAD,EAAM;QACZ,CAAC,KAAKyL,QAAV,EAAoB;YACZ,+BAAN;;;WAEK,KAAKA,QAAL,CAAcX,YAAd,CAA2B,IAA3B,EAAiC9K,GAAjC,CAAP;;;EAGFoL,UAAU,CAACpL,GAAD,EAAM;QACV,CAAC,KAAKyL,QAAV,EAAoB;YACZ,+BAAN;;;WAEK,KAAKA,QAAL,CAAcL,UAAd,CAAyB,IAAzB,EAA+BpL,GAA/B,CAAP;;;EAGFsL,UAAU,CAACtL,GAAD,EAAM;QACV,CAAC,KAAKyL,QAAV,EAAoB;YACZ,+BAAN;;;WAEK,KAAKA,QAAL,CAAcH,UAAd,CAAyB,IAAzB,EAA+BtL,GAA/B,CAAP;;;EAGFuL,SAAS,CAACvL,GAAD,EAAM;QACT,CAAC,KAAKyL,QAAV,EAAoB;YACZ,+BAAN;;;WAEK,KAAKA,QAAL,CAAcF,SAAd,CAAwB,IAAxB,EAA8BvL,GAA9B,CAAP;;;;;AC1FW,MAAM+L,MAAN,CAAa;EAC1BhM,WAAW,CAACiM,UAAD,EAAa;SACjBA,UAAL,GAAkBA,UAAlB;SACKC,aAAL,GAAqB,KAAKC,iBAAL,CAAuB,KAAKF,UAA5B,CAArB;;;EAGFE,iBAAiB,CAACF,UAAD,EAAa;UACtBzL,GAAG,GAAG,EAAZ;UAEM4L,KAAK,GAAGH,UAAU,CAACG,KAAzB;;SAEK,IAAI3G,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG2G,KAAK,CAACtL,MAA1B,EAAkC2E,CAAC,EAAnC,EAAuC;YAC/BV,IAAI,GAAG/D,MAAM,CAACC,MAAP,CAAc,EAAd,EAAkBmL,KAAK,CAAC3G,CAAD,CAAvB,CAAb;;UACIV,IAAI,CAAC8G,QAAL,KAAkB,eAAlB,IAAqC9G,IAAI,CAACgH,UAAL,KAAoB,UAA7D,EAAyE;QACvEvL,GAAG,CAACuE,IAAI,CAAC+E,QAAN,CAAH,GAAqB,IAAI2B,IAAJ,CAAS1G,IAAT,CAArB;;;;YAIIkF,SAAS,GAAGlF,IAAI,CAACkF,SAAvB;YACMoC,YAAY,GAAG,EAArB;;WAEK,IAAIC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGrC,SAAS,CAACnJ,MAA9B,EAAsCwL,CAAC,EAAvC,EAA2C;cACnCtC,QAAQ,GAAGC,SAAS,CAACqC,CAAD,CAA1B;QAEAD,YAAY,CAAE,GAAErC,QAAQ,CAAC/E,UAAW,IAAG+E,QAAQ,CAACuC,QAAS,EAA7C,CAAZ,GAA8DvC,QAA9D;;;MAGFjF,IAAI,CAACkF,SAAL,GAAiBoC,YAAjB;YAEMjG,UAAU,GAAGrB,IAAI,CAACqB,UAAxB;YACM8D,aAAa,GAAG,EAAtB;UACIN,YAAY,GAAG,IAAnB;;WAEK,IAAI4C,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGpG,UAAU,CAACtF,MAA/B,EAAuC0L,CAAC,EAAxC,EAA4C;cACpChG,SAAS,GAAGJ,UAAU,CAACoG,CAAD,CAA5B;QAEAtC,aAAa,CAAC1D,SAAS,CAACb,WAAX,CAAb,GAAuCa,SAAvC;;YAEIA,SAAS,CAACD,cAAd,EAA8B;UAC5BqD,YAAY,GAAGpD,SAAf;;;;MAIJzB,IAAI,CAACqB,UAAL,GAAkBA,UAAlB;MACArB,IAAI,CAACmF,aAAL,GAAqBA,aAArB;MACAnF,IAAI,CAAC6E,YAAL,GAAoBA,YAApB;MAEApJ,GAAG,CAACuE,IAAI,CAAC+E,QAAN,CAAH,GAAqB,IAAI2B,IAAJ,CAAS1G,IAAT,CAArB;;;WAGKvE,GAAP;;;EAGFiM,mBAAmB,GAAG;UACdC,OAAO,GAAG,KAAKT,UAAL,CAAgBS,OAAhC;;QACIA,OAAJ,EAAa;aACJA,OAAO,CAACC,uBAAf;;;WAEK,IAAP;;;EAGFC,oBAAoB,GAAG;UACfF,OAAO,GAAG,KAAKT,UAAL,CAAgBS,OAAhC;;QACIA,OAAJ,EAAa;aACJA,OAAO,CAACG,sBAAR,GAAiC,IAAxC;;;WAEK,IAAP;;;EAGFpD,OAAO,CAACF,QAAD,EAAW;WACT,KAAK2C,aAAL,CAAmB3C,QAAnB,KAAgC,IAAIkC,IAAJ,CAASlC,QAAT,CAAvC;;;EAGFkB,MAAM,GAAG;WACA,KAAKwB,UAAL,CAAgBnH,GAAvB;;;EAGFgI,mBAAmB,GAAG;WACb,KAAKrC,MAAL,GAAcsC,MAAd,KAAyB,IAAhC;;;;;AC5EJ,MAAM1O,QAAM,GAAG;EACbC,IAAI,EAAE,QADO;EAEbU,iBAAiB,EAAE;kBACH;MACZV,IAAI,EAAE,QADM;MAEZC,UAAU,EAAE;QACVyO,SAAS,EAAE;UACT1O,IAAI,EAAE,OADG;UAET2O,KAAK,EAAE;YACL3O,IAAI,EAAE,CAAC,SAAD,EAAY,QAAZ,CADD;YAELK,YAAY,EAAE;cACZL,IAAI,EACF;;WANG;UASTK,YAAY,EAAE;YACZL,IAAI,EAAE;;SAXA;QAcV4O,SAAS,EAAE;UACT5O,IAAI,EAAE,OADG;UAET2O,KAAK,EAAE;YACL3O,IAAI,EAAE,CAAC,SAAD,EAAY,QAAZ,CADD;YAELK,YAAY,EAAE;cACZL,IAAI,EACF;;WANG;UASTK,YAAY,EAAE;YACZL,IAAI,EAAE;;SAxBA;QA2BV4E,UAAU,EAAE;UACV5E,IAAI,EAAE,OADI;UAEV2O,KAAK,EAAE;YACL3O,IAAI,EAAE,QADD;YAELC,UAAU,EAAE;cACV4O,SAAS,EAAE;gBACT7O,IAAI,EAAE,QADG;gBAETG,SAAS,EAAE,EAFF;gBAGTE,YAAY,EAAE;kBACZL,IAAI,EACF,sHAFU;kBAGZG,SAAS,EACP;;eARI;cAWV+F,QAAQ,EAAE;gBACRlG,IAAI,EAAE,QADE;gBAERe,IAAI,EAAE,CACJ,IADI,EAEJ,QAFI,EAGJ,IAHI,EAIJ,QAJI,EAKJ,IALI,EAMJ,KANI,EAOJ,IAPI,EAQJ,KARI,EASJ,MATI,EAUJ,OAVI,EAWJ,OAXI,EAYJ,QAZI,CAFE;gBAgBRV,YAAY,EAAE;kBACZL,IAAI,EACF,qKAFU;kBAGZe,IAAI,EACF;;eA/BI;cAkCV+E,KAAK,EAAE;gBACL9F,IAAI,EAAE,CAAC,QAAD,EAAW,QAAX,EAAqB,SAArB,EAAgC,OAAhC,CADD;gBAELG,SAAS,EAAE,IAFN;gBAGLwO,KAAK,EAAE;kBACLhO,KAAK,EAAE,CACL;oBACEX,IAAI,EAAE,QADR;oBAEEK,YAAY,EAAE;sBACZL,IAAI,EACF;;mBALD,EAQL;oBACEA,IAAI,EAAE,QADR;oBAEEG,SAAS,EAAE,IAFb;oBAGEE,YAAY,EAAE;sBACZF,SAAS,EACP;;mBAbD;iBAJJ;gBAsBL2O,QAAQ,EAAE,CAtBL;gBAuBLzO,YAAY,EAAE;kBACZL,IAAI,EACF,gGAFU;kBAGZG,SAAS,EACP,wEAJU;kBAKZ2O,QAAQ,EACN;;;aAjEH;YAqELzO,YAAY,EAAE;cACZL,IAAI,EACF;;WAzEI;UA4EVK,YAAY,EAAE;YACZL,IAAI,EACF;;SAzGI;QA4GV+O,MAAM,EAAE;UACN/O,IAAI,EAAE,QADA;UAENgP,OAAO,EAAE,GAFH;UAGNC,OAAO,EAAE,GAHH;UAIN5O,YAAY,EAAE;YACZL,IAAI,EAAE,yDADM;YAEZgP,OAAO,EAAE,iDAFG;YAGZC,OAAO,EAAE;;SAnHH;QAsHVC,MAAM,EAAE;UACNlP,IAAI,EAAE,SADA;UAENK,YAAY,EAAE;YACZL,IAAI,EAAE;;;OA3HA;MA+HZa,oBAAoB,EAAE,KA/HV;MAgIZR,YAAY,EAAE;QACZL,IAAI,EACF,gFAFU;QAGZa,oBAAoB,EAClB;;;GAvIK;EA2IbR,YAAY,EAAE;IACZK,iBAAiB,EAAE;;CA5IvB;AAgJA,MAAMO,KAAG,GAAGC,GAAG,CAAC;EAACC,SAAS,EAAE,IAAZ;EAAkBC,YAAY,EAAE;CAAjC,CAAf;AACAC,SAAS,CAACJ,KAAD,CAAT;AACA,MAAMK,UAAQ,GAAGL,KAAG,CAACM,OAAJ,CAAYxB,QAAZ,CAAjB;AAEA,AAAO,MAAMoP,iBAAiB,GAAGC,UAAU,IAAI;QACvCxN,OAAO,GAAGN,UAAQ,CAAC8N,UAAD,CAAxB;;MACI,CAACxN,OAAL,EAAc;IACZjC,MAAM,CAAC2B,UAAQ,CAACW,MAAT,CAAgBC,GAAhB,CAAoBC,CAAC,IAAIA,CAAC,CAACC,OAA3B,CAAD,CAAN;;;SAEKR,OAAP;CALK;;ACjIP,MAAMyN,8BAA8B,GAAG;GACpC/L,gBAAD,GAAoB,IAAIgM,GAAJ,CAAQ,CAC1B1L,gBAD0B,EAE1BC,oBAF0B,EAG1BC,gBAH0B,EAI1BC,oBAJ0B,CAAR,CADiB;GAOpCR,aAAD,GAAiB,IAAI+L,GAAJ,CAAQ,CACvB1L,gBADuB,EAEvBC,oBAFuB,EAGvBC,gBAHuB,EAIvBC,oBAJuB,EAKvBC,gBALuB,EAMvBC,iBANuB,EAOvBC,gBAPuB,EAQvBC,iBARuB,CAAR,CAPoB;GAiBpCX,eAAD,GAAmB,IAAI8L,GAAJ,CAAQ,CACzB1L,gBADyB,EAEzBC,oBAFyB,EAGzBC,gBAHyB,EAIzBC,oBAJyB,EAKzBC,gBALyB,EAMzBC,iBANyB,EAOzBC,gBAPyB,EAQzBC,iBARyB,CAAR,CAjBkB;GA2BpCV,iBAAD,GAAqB,IAAI6L,GAAJ,CAAQ,CAAC1L,gBAAD,EAAmBC,oBAAnB,CAAR,CA3BgB;GA4BpCH,cAAD,GAAkB,IAAI4L,GAAJ,CAAQ,CACxB1L,gBADwB,EAExBC,oBAFwB,EAGxBC,gBAHwB,EAIxBC,oBAJwB,EAKxBK,kBALwB,EAMxBC,mBANwB,EAOxBC,mBAPwB,EAQxBC,oBARwB,CAAR,CA5BmB;GAsCpCZ,kBAAD,GAAsB,IAAI2L,GAAJ,CAAQ,CAC5B1L,gBAD4B,EAE5BC,oBAF4B,EAG5BC,gBAH4B,EAI5BC,oBAJ4B,EAK5BK,kBAL4B,EAM5BC,mBAN4B,EAO5BC,mBAP4B,EAQ5BC,oBAR4B,CAAR;CAtCxB;AAkDA,AAAO,MAAMgL,mBAAmB,GAAGH,UAAU,IAAI;MAC3C,CAACD,iBAAiB,CAACC,UAAD,CAAtB,EAAoC;WAC3B,IAAP;;;QAGItB,KAAK,GAAG,EAAd;QACM0B,IAAI,GAAG9M,MAAM,CAAC8M,IAAP,CAAYJ,UAAZ,CAAb;;OACK,IAAIjI,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGqI,IAAI,CAAChN,MAAzB,EAAiC2E,CAAC,EAAlC,EAAsC;UAC9ByB,GAAG,GAAG4G,IAAI,CAACrI,CAAD,CAAhB;UACMsI,MAAM,GAAGL,UAAU,CAACxG,GAAD,CAAzB;UACMsG,MAAM,GAAGO,MAAM,CAACP,MAAP,KAAkB7M,SAAlB,GAA8BoN,MAAM,CAACP,MAArC,GAA8C,IAA7D;UACMQ,QAAQ,GAAG;MACfnC,QAAQ,EAAE,OADK;MAEf7F,OAAO,EAAEkB,GAFM;MAGf6C,QAAQ,EAAE,CAACyD,MAHI;MAIfS,eAAe,OAJA;MAKfnE,QAAQ,EAAE5C,GALK;MAMf6E,UAAU,EAAE;KANd;UAQMiB,SAAS,GAAGe,MAAM,CAACf,SAAP,IAAoB,EAAtC;UACME,SAAS,GAAGa,MAAM,CAACb,SAAP,IAAoB,EAAtC;UACMgB,YAAY,GAAG,IAAIN,GAAJ,CAAQV,SAAR,CAArB;UACMiB,iBAAiB,GAAGnB,SAAS,CAAC3G,MAAV,CAAiBZ,CAAC,IAAI,CAACyI,YAAY,CAACE,GAAb,CAAiB3I,CAAjB,CAAvB,CAA1B;IAEAuI,QAAQ,CAAC5H,UAAT,GAAsB,CACpB;MACET,WAAW,EAAE,eADf;MAEEmE,QAAQ,EAAE,KAFZ;MAGEuE,SAAS,EAAE,KAHb;MAIE9H,cAAc,EAAE;KALE,EAOpB;MACEZ,WAAW,EAAE,cADf;MAEEmE,QAAQ,EAAE,IAFZ;MAGEuE,SAAS,EAAE,KAHb;MAIE9H,cAAc,EAAE;KAXE,CAAtB;IAeAyH,QAAQ,CAAC/D,SAAT,GAAqB,EAArB;IAEA+D,QAAQ,CAAC/D,SAAT,GAAqB+D,QAAQ,CAAC/D,SAAT,CAAmBqE,MAAnB,CACnBH,iBAAiB,CAAC3N,GAAlB,CAAsBiF,CAAC,KAAK;MAC1BE,WAAW,EAAE,cADa;MAE1BV,UAAU,EAAE,MAFc;MAG1BsH,QAAQ,EAAE9G,CAAC,CAAC8I,QAAF;KAHW,CAAvB,CADmB,CAArB;IAQAP,QAAQ,CAAC/D,SAAT,GAAqB+D,QAAQ,CAAC/D,SAAT,CAAmBqE,MAAnB,CACnBpB,SAAS,CAAC1M,GAAV,CAAciF,CAAC,KAAK;MAClBE,WAAW,EAAE,eADK;MAElBV,UAAU,EAAE,MAFM;MAGlBsH,QAAQ,EAAE9G,CAAC,CAAC8I,QAAF;KAHG,CAAf,CADmB,CAArB;IAQAP,QAAQ,CAAC7I,MAAT,GAAkB,CAAC;MAACQ,WAAW,EAAE,cAAd;MAA8BJ,UAAU,EAAE;KAA3C,CAAlB;;QAEIwI,MAAM,CAAC7K,UAAX,EAAuB;YACf0C,KAAK,GAAGmI,MAAM,CAAC7K,UAAP,IAAqB,EAAnC;YACMsL,SAAS,GAAG,EAAlB;;WAEK,IAAIlC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG1G,KAAK,CAAC9E,MAA1B,EAAkCwL,CAAC,EAAnC,EAAuC;cAC/BxG,CAAC,GAAGF,KAAK,CAAC0G,CAAD,CAAf;YACIhO,IAAJ;;YACImQ,KAAK,CAACC,OAAN,CAAc5I,CAAC,CAAC1B,KAAhB,CAAJ,EAA4B;gBACpBuK,KAAK,GAAG,IAAIf,GAAJ,CACZ9H,CAAC,CAAC1B,KAAF,CAAQ5D,GAAR,CAAY4C,CAAC,IAAIH,UAAU,CAACE,mBAAX,CAA+BC,CAA/B,CAAjB,CADY,CAAd;;cAIIuL,KAAK,CAACC,IAAN,IAAc,CAAlB,EAAqB;YACnB3Q,MAAM,CACJ,sJADI,CAAN;mBAGO,IAAP;;;UAGFK,IAAI,GAAGmQ,KAAK,CAACI,IAAN,CAAWF,KAAX,EAAkB,CAAlB,CAAP;SAZF,MAaO;UACLrQ,IAAI,GAAG2E,UAAU,CAACE,mBAAX,CAA+B2C,CAAC,CAAC1B,KAAjC,CAAP;;;cAGI0K,KAAK,GAAG;UACZ9K,aAAa,EAAE8B,CAAC,CAACqH,SADL;UAEZlJ,aAAa,EAAE3F,IAFH;UAGZkG,QAAQ,EAAEsB,CAAC,CAACtB,QAHA;UAIZJ,KAAK,EAAE,CAACqK,KAAK,CAACC,OAAN,CAAc5I,CAAC,CAAC1B,KAAhB,CAAD,GAA0B0B,CAAC,CAAC1B,KAA5B,GAAoC,IAJ/B;UAKZE,SAAS,EAAE,CAACmK,KAAK,CAACC,OAAN,CAAc5I,CAAC,CAAC1B,KAAhB,CAAD,GAA0B,IAA1B,GAAiC0B,CAAC,CAAC1B;SALhD;;YAQI,CAACuJ,8BAA8B,CAACrP,IAAD,CAA9B,CAAqC8P,GAArC,CAAyCtI,CAAC,CAACtB,QAA3C,CAAL,EAA2D;UACzDvG,MAAM,CACH,kCACC6H,CAAC,CAACtB,QACH,uCAAsClG,IAAK,IAHxC,CAAN;iBAKO,IAAP;;;YAGEwQ,KAAK,CAACxK,SAAV,EAAqB;cAEjBwK,KAAK,CAACtK,QAAN,KAAmBpC,gBAAnB,IACA0M,KAAK,CAACtK,QAAN,KAAmBnC,oBAFrB,EAGE;YACApE,MAAM,CACJ,iFADI,CAAN;mBAGO,IAAP;;SARJ,MAUO;cAEH6Q,KAAK,CAACtK,QAAN,KAAmBpC,gBAAnB,IACA0M,KAAK,CAACtK,QAAN,KAAmBnC,oBAFrB,EAGE;YACApE,MAAM,CACJ,wGADI,CAAN;mBAGO,IAAP;;;;QAIJuQ,SAAS,CAACnH,IAAV,CAAeyH,KAAf;;;MAGFd,QAAQ,CAAC1D,WAAT,GAAuB,CACrB;QACEtE,OAAO,EAAE,cADX;QAEEf,UAAU,EAAE,MAFd;QAGEM,UAAU,EAAEwI,MAAM,CAACV,MAAP,IAAiB,GAH/B;QAIEzH,KAAK,EAAE4I,SAJT;QAKEpJ,SAAS,EAAE;OANQ,CAAvB;KAlEF,MA2EO;MACL4I,QAAQ,CAAC1D,WAAT,GAAuB,CACrB;QACEtE,OAAO,EAAE,cADX;QAEEf,UAAU,EAAE,MAFd;QAGEM,UAAU,EAAEwI,MAAM,CAACV,MAAP,IAAiB,GAH/B;QAIEzH,KAAK,EAAE,EAJT;QAKER,SAAS,EAAE;OANQ,CAAvB;;;IAWFgH,KAAK,CAAC/E,IAAN,CAAW2G,QAAX;;;SAGK;IACL5B,KAAK,EAAEA,KADF;IAELtH,GAAG,EAAE;MACHkB,OAAO,EAAE,OADN;MAEH+G,MAAM,EAAE;;GAJZ;CArJK;;ACrEQ,MAAMgC,IAAN,SAAmBlG,WAAnB,CAA+B;QACtCmG,SAAN,CAAgBtB,UAAhB,EAA4B;UACpBzB,UAAU,GAAG4B,mBAAmB,CAACH,UAAD,CAAtC;;QACIzB,UAAU,KAAK,IAAnB,EAAyB;YACjB,gEAAN;;;SAEGzC,MAAL,GAAc,IAAIwC,MAAJ,CAAWC,UAAX,CAAd;;;;;ACDJ,MAAMgD,UAAU,GAAG,IAAIF,IAAJ,EAAnB;AACAE,UAAU,CAACD,SAAX,CAAqB,EAArB;;ACRe,MAAME,aAAN,CAAoB;EACjClP,WAAW,CAACmP,OAAD,EAAU;SACdpC,MAAL,GAAcoC,OAAO,CAACpC,MAAtB;SACKqC,OAAL,GAAe,IAAIC,WAAJ,EAAf;;;QAGIC,IAAN,GAAa;IACXnR,OAAO,CAACoR,IAAR,CAAa,8DAAb;UACM,KAAKH,OAAL,CAAaJ,SAAb,CAAuB;MAACjC,MAAM,EAAE,KAAKA;KAArC,CAAN;;;EAGFvB,SAAS,CAACgE,gBAAD,EAAmBpP,MAAnB,EAA2B;IAClCjC,OAAO,CAACoR,IAAR,CAAa,8DAAb;WACO,KAAKH,OAAL,CAAarK,IAAb,CAAkByK,gBAAlB,EAAoChE,SAApC,CAA8CpL,MAA9C,CAAP;;;EAGFqP,YAAY,CAACD,gBAAD,EAAmBpP,MAAnB,EAA2B;IACrCjC,OAAO,CAACoR,IAAR,CAAa,8DAAb;WACO,KAAKH,OAAL,CAAarK,IAAb,CAAkByK,gBAAlB,EAAoCzE,YAApC,CAAiD3K,MAAjD,CAAP;;;EAGFmL,UAAU,CAACiE,gBAAD,EAAmBpP,MAAnB,EAA2B;IACnCjC,OAAO,CAACoR,IAAR,CAAa,8DAAb;WACO,KAAKH,OAAL,CAAarK,IAAb,CAAkByK,gBAAlB,EAAoCjE,UAApC,CAA+CnL,MAA/C,CAAP;;;;;;;"}